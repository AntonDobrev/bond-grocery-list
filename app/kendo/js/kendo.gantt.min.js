/*
* Kendo UI Beta v2014.3.1029 (http://www.telerik.com/kendo-ui)
* Copyright 2014 Telerik AD. All rights reserved.
*
* Kendo UI Beta license terms available at
* http://www.telerik.com/purchase/license-agreement/kendo-ui-beta.aspx
*/

!function(t,define){define(["./kendo.data.min","./kendo.popup.min","./kendo.window.min","./kendo.resizable.min","./kendo.gantt.list.min","./kendo.gantt.timeline.min"],t)}(function(){return function(t,e){function n(t){return"["+f.attr("uid")+(t?"='"+t+"']":"]")}function i(t){return delete t.name,delete t.prefix,delete t.remove,delete t.edit,delete t.add,delete t.navigate,t}function o(t){var e,n,i,o,r,a;if(t.filter("[name=end], [name=start]").length){for(e=t.attr("name"),n=f.widgetInstance(t,f.ui),i={},o=t;o!==window&&!r;)o=o.parent(),r=o.data("kendoEditable");return(a=r?r.options.model:null)?(i.start=a.start,i.end=a.end,i[e]=n?n.value():f.parseDate(t.value()),i.end>=i.start):!0}return!0}function r(e,n){var i=e.parents("["+f.attr("role")+'="gantt"]'),o=[],r=a(i);e.attr(T,0),n&&r.each(function(e,n){o[e]=t(n).scrollTop()});try{e[0].setActive()}catch(s){e[0].focus()}n&&r.each(function(e,n){t(n).scrollTop(o[e])})}function a(e){return t(e).parentsUntil("body").filter(function(t,e){var n=f.getComputedStyles(e,["overflow"]);return"visible"!=n.overflow}).add(window)}var s,l,c,d,h,u,f=window.kendo,p=f.support.browser,g=f.Observable,m=f.ui.Widget,v=f.data.DataSource,y=f.data.Query,w=t.isArray,_=t.proxy,x=t.extend,b=t.isPlainObject,k=t.map,C=f.keys,S=".kendoGantt",T="tabIndex",D="click",A="width",P="string",E={down:{origin:"bottom center",position:"top center"},up:{origin:"top center",position:"bottom center"}},M="aria-activedescendant",I="gantt_active_cell",B="action-option-focused",L=".",z="Are you sure you want to delete this task?",F="Are you sure you want to delete this dependency?",R='<a class="#=className#" #=attr# href="\\#">#=text#</a>',O=f.template('<div class="#=styles.headerWrapper#">#if (editable) {#<div class="#=styles.actions#"><button class="#=styles.button#" data-action="#=action.data#"><span class="#=styles.iconPlus#"></span>#=action.title#</button></div>#}#<ul class="#=styles.viewsWrapper#">#for(var view in views){#<li class="#=styles.viewButtonDefault# #=styles.viewButton#-#= view.toLowerCase() #" data-#=ns#name="#=view#"><a href="\\#" class="#=styles.link#">#=views[view].title#</a></li>#}#</ul></div>'),N=f.template('<div class="#=styles.popupWrapper#"><ul class="#=styles.popupList#" role="listbox">#for(var i = 0, l = actions.length; i < l; i++){#<li class="#=styles.item#" data-action="#=actions[i].data#" role="option">#=actions[i].text#</span>#}#</ul></div>'),V=f.template('<div class="#=styles.footerWrapper#"><div class="#=styles.actions#"><button class="#=styles.button#" data-action="#=action.data#"><span class="#=styles.iconPlus#"></span>#=action.title#</button></div></div>'),H=function(e,n){var i={name:n.field},o=n.model.fields[n.field].validation;o&&b(o)&&o.message&&(i[f.attr("dateCompare-msg")]=o.message),t('<input type="text" required '+f.attr("type")+'="date" '+f.attr("role")+'="datetimepicker" '+f.attr("bind")+'="value:'+n.field+'" '+f.attr("validate")+"='true' />").attr(i).appendTo(e),t("<span "+f.attr("for")+'="'+n.field+'" class="k-invalid-msg"/>').hide().appendTo(e)},U={wrapper:"k-widget k-gantt",listWrapper:"k-gantt-layout k-gantt-treelist",list:"k-gantt-treelist",timelineWrapper:"k-gantt-layout k-gantt-timeline",timeline:"k-gantt-timeline",splitBarWrapper:"k-splitbar k-state-default k-splitbar-horizontal k-splitbar-draggable-horizontal k-gantt-layout",splitBar:"k-splitbar",splitBarHover:"k-splitbar-horizontal-hover",popupWrapper:"k-list-container",popupList:"k-list k-reset",resizeHandle:"k-resize-handle",icon:"k-icon",item:"k-item",line:"k-line",buttonDelete:"k-gantt-delete",buttonCancel:"k-gantt-cancel",primary:"k-primary",hovered:"k-state-hover",selected:"k-state-selected",focused:"k-state-focused",gridHeader:"k-grid-header",gridHeaderWrap:"k-grid-header-wrap",gridContent:"k-grid-content",popup:{form:"k-popup-edit-form",editForm:"k-gantt-edit-form",formContainer:"k-edit-form-container",message:"k-popup-message",buttonsContainer:"k-edit-buttons k-state-default",button:"k-button",editField:"k-edit-field",editLabel:"k-edit-label"},toolbar:{headerWrapper:"k-floatwrap k-header k-gantt-toolbar",footerWrapper:"k-floatwrap k-header k-gantt-toolbar",toolbar:"k-gantt-toolbar",views:"k-gantt-views",viewsWrapper:"k-reset k-header k-gantt-views",actions:"k-gantt-actions",button:"k-button k-button-icontext",iconPlus:"k-icon k-i-plus",viewButtonDefault:"k-state-default",viewButton:"k-view",link:"k-link"}},W=g.extend({init:function(t,e){g.fn.init.call(this),this.element=t,this.options=x(!0,{},this.options,e),this._popup()},options:{direction:"down",navigatable:!1},_current:function(t){var e=u.styles,n=this.list.find(L+e.focused),i=n[t]();i.length&&(n.removeClass(e.focused).removeAttr("id"),i.addClass(e.focused).attr("id",B),this.list.find("ul").removeAttr(M).attr(M,B))},_popup:function(){var e=this,n=u.styles,i="li"+L+n.item,o=this.options.messages.actions,r=this.options.navigatable;this.list=t(N({styles:n,actions:[{data:"add",text:o.addChild},{data:"insert-before",text:o.insertBefore},{data:"insert-after",text:o.insertAfter}]})),this.element.append(this.list),this.popup=new f.ui.Popup(this.list,x({anchor:this.element,open:function(){e._adjustListWidth()},animation:this.options.animation},E[this.options.direction])),this.element.on(D+S,"button",function(i){var o=t(this),a=o.attr(f.attr("action"));i.preventDefault(),a?e.trigger("command",{type:a}):(e.popup.open(),r&&e.list.find("li:first").addClass(n.focused).attr("id",B).end().find("ul").attr({TABINDEX:0,"aria-activedescendant":B}).focus())}),this.list.find(i).hover(function(){t(this).addClass(n.hovered)},function(){t(this).removeClass(n.hovered)}).end().on(D+S,i,function(){e.trigger("command",{type:t(this).attr(f.attr("action"))}),e.popup.close()}),r&&(this.popup.bind("close",function(){e.list.find(i).removeClass(n.focused).end().find("ul").attr(T,0),e.element.parents("["+f.attr("role")+'="gantt"]').find(L+n.gridContent+" > table:first").focus()}),this.list.find("ul").on("keydown"+S,function(t){var i=t.keyCode;switch(i){case C.UP:t.preventDefault(),e._current("prev");break;case C.DOWN:t.preventDefault(),e._current("next");break;case C.ENTER:e.list.find(L+n.focused).click();break;case C.ESC:t.preventDefault(),e.popup.close()}}))},_adjustListWidth:function(){var t,e,n=this.list,i=n[0].style.width,o=this.element;(n.data(A)||!i)&&(t=window.getComputedStyle?window.getComputedStyle(o[0],null):0,e=t?parseFloat(t.width):o.outerWidth(),t&&(p.mozilla||p.msie)&&(e+=parseFloat(t.paddingLeft)+parseFloat(t.paddingRight)+parseFloat(t.borderLeftWidth)+parseFloat(t.borderRightWidth)),i="border-box"!==n.css("box-sizing")?e-(n.outerWidth()-n.width()):e,n.css({fontFamily:o.css("font-family"),width:i}).data(A,i))},destroy:function(){this.popup.destroy(),this.element.off(S),this.list.off(S),this.unbind()}}),j=function(t,e){return function(n){var i,o;if(n=w(i)?{data:n}:n,i=n||{},o=i.data,i.data=o,!(i instanceof t)&&i instanceof v)throw Error("Incorrect DataSource type. Only "+e+" instances are supported");return i instanceof t?i:new t(i)}},G=f.data.Model.define({id:"id",fields:{id:{type:"number"},predecessorId:{type:"number"},successorId:{type:"number"},type:{type:"number"}}}),q=v.extend({init:function(t){v.fn.init.call(this,x(!0,{},{schema:{modelBase:G,model:G}},t))},successors:function(t){return this._dependencies("predecessorId",t)},predecessors:function(t){return this._dependencies("successorId",t)},dependencies:function(t){var e=this.predecessors(t),n=this.successors(t);return e.push.apply(e,n),e},_dependencies:function(t,e){var n=this.view(),i={field:t,operator:"eq",value:e};return n=new y(n).filter(i).toArray()}});q.create=j(q,"GanttDependencyDataSource"),s=f.data.Model.define({duration:function(){var t=this.end,e=this.start;return t-e},isMilestone:function(){return 0===this.duration()},_offset:function(t){var e,n,i=["start","end"];for(n=0;i.length>n;n++)e=new Date(this.get(i[n]).getTime()+t),this.set(i[n],e)},id:"id",fields:{id:{type:"number"},parentId:{type:"number",defaultValue:null,validation:{required:!0}},orderId:{type:"number",validation:{required:!0}},title:{type:"string",defaultValue:""},start:{type:"date",validation:{required:!0,dateCompare:o,message:"Start date should be before or equal to the end date"}},end:{type:"date",validation:{required:!0,dateCompare:o,message:"End date should be after or equal to the start date"}},percentComplete:{type:"number",validation:{required:!0,min:0,max:1,step:.01}},summary:{type:"boolean"},expanded:{type:"boolean",defaultValue:!0}}}),l=v.extend({init:function(t){v.fn.init.call(this,x(!0,{},{schema:{modelBase:s,model:s}},t))},remove:function(t){var e=t.get("parentId"),n=this.taskAllChildren(t);return this._removeItems(n),t=v.fn.remove.call(this,t),this._childRemoved(e,t.get("orderId")),t},add:function(t){return t?(t=this._toGanttTask(t),this.insert(this.taskSiblings(t).length,t)):e},insert:function(t,n){return n?(n=this._toGanttTask(n),n.set("orderId",t),n=v.fn.insert.call(this,t,n),this._reorderSiblings(n,this.taskSiblings(n).length-1),this._resolveSummaryFields(this.taskParent(n)),n):e},taskChildren:function(t){var n,i=this.view(),o={field:"parentId",operator:"eq",value:null},r=this._sort||{field:"orderId",dir:"asc"};if(t){if(n=t.get("id"),n===e||null===n)return[];o.value=n}return i=new y(i).filter(o).sort(r).toArray()},taskAllChildren:function(t){var e=[],n=this,i=function(t){var o=n.taskChildren(t);e.push.apply(e,o),k(o,i)};return t?i(t):e=this.view(),e},taskSiblings:function(t){if(!t)return null;var e=this.taskParent(t);return this.taskChildren(e)},taskParent:function(t){return t&&null!==t.get("parentId")?this.get(t.parentId):null},taskLevel:function(t){for(var e=0,n=this.taskParent(t);null!==n;)e+=1,n=this.taskParent(n);return e},taskTree:function(t){var e,n,i,o,r=[],a=this.taskChildren(t);for(n=0,i=a.length;i>n;n++)e=a[n],r.push(e),e.get("expanded")&&(o=this.taskTree(e),r.push.apply(r,o));return r},update:function(t,n){var i,o,r=this,a=function(t,e){var n,i,o=r.taskAllChildren(t);for(n=0,i=o.length;i>n;n++)o[n]._offset(e)},s=function(t){var e=t.field,n=t.sender;switch(e){case"start":r._resolveSummaryStart(r.taskParent(n)),a(n,n.get(e).getTime()-i.getTime());break;case"end":r._resolveSummaryEnd(r.taskParent(n));break;case"percentComplete":r._resolveSummaryPercentComplete(r.taskParent(n));break;case"orderId":r._reorderSiblings(n,i)}};n.parentId!==e&&(i=t.get("parentId"),i!==n.parentId&&(t.set("parentId",n.parentId),r._childRemoved(i,t.get("orderId")),t.set("orderId",r.taskSiblings(t).length-1),r._resolveSummaryFields(r.taskParent(t))),delete n.parentId),t.bind("change",s);for(o in n)i=t.get(o),t.set(o,n[o]);t.unbind("change",s)},_resolveSummaryFields:function(t){t&&(this._updateSummary(t),this.taskChildren(t).length&&(this._resolveSummaryStart(t),this._resolveSummaryEnd(t),this._resolveSummaryPercentComplete(t)))},_resolveSummaryStart:function(t){var e=this,n=function(t){var n,i,o,r=e.taskChildren(t),a=r[0].start.getTime();for(i=1,o=r.length;o>i;i++)n=r[i].start.getTime(),a>n&&(a=n);return new Date(a)};this._updateSummaryRecursive(t,"start",n)},_resolveSummaryEnd:function(t){var e=this,n=function(t){var n,i,o,r=e.taskChildren(t),a=r[0].end.getTime();for(i=1,o=r.length;o>i;i++)n=r[i].end.getTime(),n>a&&(a=n);return new Date(a)};this._updateSummaryRecursive(t,"end",n)},_resolveSummaryPercentComplete:function(t){var e=this,n=function(t){var n=e.taskChildren(t),i=new y(n).aggregate([{field:"percentComplete",aggregate:"average"}]);return i.percentComplete.average};this._updateSummaryRecursive(t,"percentComplete",n)},_updateSummaryRecursive:function(t,e,n){var i,o;t&&(i=n(t),t.set(e,i),o=this.taskParent(t),o&&this._updateSummaryRecursive(o,e,n))},_childRemoved:function(t,e){var n,i,o=null===t?null:this.get(t),r=this.taskChildren(o);for(n=e,i=r.length;i>n;n++)r[n].set("orderId",n);this._resolveSummaryFields(o)},_reorderSiblings:function(t,e){var n,i=t.get("orderId"),o=i>e,r=o?e:i,a=o?i:e,s=o?r:r+1,l=this.taskSiblings(t);for(a=Math.min(a,l.length-1),n=r;a>=n;n++)l[n]!==t&&(l[n].set("orderId",s),s+=1)},_updateSummary:function(t){if(null!==t){var e=this.taskChildren(t).length;t.set("summary",e>0)}},_toGanttTask:function(t){if(!(t instanceof s)){var e=t;t=this._createNewModel(),t.accept(e)}return t}}),l.create=j(l,"GanttDataSource"),x(!0,f.data,{GanttDataSource:l,GanttTask:s,GanttDependencyDataSource:q,GanttDependency:G}),c={desktop:{dateRange:H}},d=f.Observable.extend({init:function(t,e){f.Observable.fn.init.call(this),this.element=t,this.options=x(!0,{},this.options,e),this.createButton=this.options.createButton},fields:function(t){var e=this.options.messages.editor,n=[{field:"title",title:e.title},{field:"start",title:e.start,editor:t.dateRange},{field:"end",title:e.end,editor:t.dateRange},{field:"percentComplete",title:e.percentComplete,format:"p0"}];return n},_buildEditTemplate:function(t,e,n){var i,o,r,a,s=this.options.editable.template,l=x({},f.Template,this.options.templateSettings),c=l.paramName,d=u.styles.popup,h="";if(s)typeof s===P&&(s=window.unescape(s)),h+=f.template(s,l)(t);else for(i=0,o=e.length;o>i;i++)r=e[i],h+='<div class="'+d.editLabel+'"><label for="'+r.field+'">'+(r.title||r.field||"")+"</label></div>",!t.editable||t.editable(r.field)?(n.push(r),h+="<div "+f.attr("container-for")+'="'+r.field+'" class="'+d.editField+'"></div>'):(a="#:",r.field?(r=f.expr(r.field,c),a+=r+"==null?'':"+r):a+="''",a+="#",a=f.template(a,l),h+='<div class="'+d.editField+'">'+a(t)+"</div>");return h}}),h=d.extend({destroy:function(){this.close(),this.unbind()},editTask:function(t){this.editable=this._createPopupEditor(t)},close:function(){var t=this,e=function(){t.editable&&(t.editable.destroy(),t.editable=null,t.container=null),t.popup&&(t.popup.destroy(),t.popup=null)};this.editable&&this.container.is(":visible")?this.container.data("kendoWindow").bind("deactivate",e).close():e()},showDialog:function(e){var n,i,o,r,a=e.buttons,s=u.styles.popup,l=f.format('<div class="{0}"><div class="{1}"><p class="{2}">{3}</p><div class="{4}">',s.form,s.formContainer,s.message,e.text,s.buttonsContainer);for(n=0,i=a.length;i>n;n++)l+=this.createButton(a[n]);l+="</div></div></div>",o=this.element,this.popup&&this.popup.destroy(),r=this.popup=t(l).appendTo(o).eq(0).on("click",L+s.button,function(e){e.preventDefault(),r.close();var n=t(e.currentTarget).index();a[n].click()}).kendoWindow({modal:!0,resizable:!1,draggable:!1,title:e.title,visible:!1,close:function(){this.destroy(),o.focus()}}).getKendoWindow(),r.center().open()},_createPopupEditor:function(e){var n,i,o=this,r={},a=this.options.messages,s=u.styles.popup,l=f.format('<div {0}="{1}" class="{2} {3}"><div class="{4}">',f.attr("uid"),e.uid,s.form,s.editForm,s.formContainer),d=this.fields(c.desktop,e),h=[];return l+=this._buildEditTemplate(e,d,h),l+='<div class="'+s.buttonsContainer+'">',l+=this.createButton({name:"update",text:a.save,className:u.styles.primary}),l+=this.createButton({name:"cancel",text:a.cancel}),l+=this.createButton({name:"delete",text:a.destroy}),l+="</div></div></div>",n=this.container=t(l).appendTo(this.element).eq(0).kendoWindow(x({modal:!0,resizable:!1,draggable:!0,title:a.editor.editorTitle,visible:!1,close:function(t){t.userTriggered&&o.trigger("cancel",{container:n,model:e})&&t.preventDefault()}},r)),i=n.kendoEditable({fields:h,model:e,clearContainer:!1,validateOnBlur:!0,target:o.options.target}).data("kendoEditable"),this.trigger("edit",{container:n,model:e})?o.trigger("cancel",{container:n,model:e}):(n.data("kendoWindow").center().open(),n.on(D+S,"a.k-gantt-cancel",function(t){t.preventDefault(),t.stopPropagation(),o.trigger("cancel",{container:n,model:e})}),n.on(D+S,"a.k-gantt-update",function(t){var i,r,a,s,l;for(t.preventDefault(),t.stopPropagation(),i=o.fields(c.desktop,e),r={},s=0,l=i.length;l>s;s++)a=i[s].field,r[a]=e.get(a);o.trigger("save",{container:n,model:e,updateInfo:r})}),n.on(D+S,"a.k-gantt-delete",function(t){t.preventDefault(),t.stopPropagation(),o.trigger("remove",{container:n,model:e})})),i}}),u=m.extend({init:function(t,e){w(e)&&(e={dataSource:e}),m.fn.init.call(this,t,e),this._wrapper(),this._timeline(),this._toolbar(),this._footer(),this._adjustDimensions(),this._preventRefresh=!0,this.view(this.timeline._selectedViewName),this._preventRefresh=!1,this._dataSource(),this._dropDowns(),this._list(),this._dependencies(),this._resizable(),this._scrollable(),this._dataBind(),this._attachEvents(),this._createEditor(),f.notify(this)},events:["dataBinding","dataBound","add","edit","remove","cancel","save","change","navigate","moveStart","move","moveEnd","resizeStart","resize","resizeEnd"],options:{name:"Gantt",autoBind:!0,navigatable:!1,selectable:!0,editable:!0,columns:[],views:[],dataSource:{},dependencies:{},messages:{save:"Save",cancel:"Cancel",destroy:"Delete",deleteTaskWindowTitle:"Delete task",deleteDependencyWindowTitle:"Delete dependency",views:{day:"Day",week:"Week",month:"Month"},actions:{append:"Add Task",addChild:"Add Child",insertBefore:"Add Above",insertAfter:"Add Below"},editor:{editorTitle:"Task",title:"Title",start:"Start",end:"End",percentComplete:"Complete"}},showWorkHours:!0,showWorkDays:!0,workDayStart:new Date(1980,1,1,8,0,0),workDayEnd:new Date(1980,1,1,17,0,0),workWeekStart:1,workWeekEnd:5,hourSpan:1,snap:!0,height:600,listWidth:"30%"},select:function(t){var n=this.list;return t?(n.select(t),e):n.select()},clearSelection:function(){this.list.clearSelection()},destroy:function(){m.fn.destroy.call(this),this.dataSource&&(this.dataSource.unbind("change",this._refreshHandler),this.dataSource.unbind("progress",this._progressHandler),this.dataSource.unbind("error",this._errorHandler)),this.dependencies&&(this.dependencies.unbind("change",this._dependencyRefreshHandler),this.dependencies.unbind("error",this._dependencyErrorHandler)),this.timeline&&(this.timeline.unbind(),this.timeline.destroy()),this.list&&(this.list.unbind(),this.list.destroy()),this.footerDropDown&&this.footerDropDown.destroy(),this.headerDropDown&&this.headerDropDown.destroy(),this._editor&&this._editor.destroy(),this._resizeDraggable&&this._resizeDraggable.destroy(),this.toolbar.off(S),t(window).off("resize"+S,this._resizeHandler),t(this.wrapper).off(S),this.toolbar=null,this.footer=null},_attachEvents:function(){this._resizeHandler=_(this.resize,this),t(window).on("resize"+S,this._resizeHandler)},_wrapper:function(){var t=u.styles,e=[t.icon,t.resizeHandle].join(" "),n=this.options,i=n.height,o=n.width;this.wrapper=this.element.addClass(t.wrapper).append("<div class='"+t.listWrapper+"'><div></div></div>").append("<div class='"+t.splitBarWrapper+"'><div class='"+e+"'></div></div>").append("<div class='"+t.timelineWrapper+"'><div></div></div>"),this.wrapper.find(L+t.list).width(n.listWidth),i&&this.wrapper.height(i),o&&this.wrapper.width(o)},_toolbar:function(){var e=this,n=u.styles,i=L+n.toolbar.views+" > li",o=n.hovered,r=t(O({ns:f.ns,views:this.timeline.views,styles:u.styles.toolbar,action:{data:"add",title:this.options.messages.actions.append},editable:this.options.editable}));this.wrapper.prepend(r),this.toolbar=r,r.on(D+S,i,function(n){n.preventDefault();var i=t(this).attr(f.attr("name"));e.trigger("navigate",{view:i})||e.view(i)}),this.wrapper.find(L+n.toolbar.toolbar+" li").hover(function(){t(this).addClass(o)},function(){t(this).removeClass(o)})},_footer:function(){if(this.options.editable){var e=t(V({styles:u.styles.toolbar,action:{data:"add",title:this.options.messages.actions.append}}));this.wrapper.append(e),this.footer=e}},_adjustDimensions:function(){var t=this.element,e=u.styles,n=L+e.list,i=L+e.timeline,o=L+e.splitBar,r=this.toolbar.outerHeight(),a=this.footer?this.footer.outerHeight():0,s=t.height(),l=t.width(),c=t.find(o).outerWidth(),d=t.find(n).outerWidth();t.children([n,i,o].join(",")).height(s-(r+a)).end().children(i).width(l-(c+d))},_scrollTo:function(t){var e=this.timeline.view(),i=f.attr("uid"),o="string"==typeof t?t:t.closest("tr"+n()).attr(i),r=e.content.find(n(o));0!==r.length&&e._scrollTo(r)},_dropDowns:function(){var t=this,e=L+u.styles.toolbar.actions,n=this.options.messages.actions,i=this.dataSource,o=this.timeline,r=function(e){var n,r=e.type,a=i._createNewModel(),s=t.dataItem(t.select()),l=i.taskParent(s),c=o.view()._timeSlots()[0],d="add"===r?s:l;a.set("title","New task"),d?(a.set("parentId",d.get("id")),a.set("start",d.get("start")),a.set("end",d.get("end"))):(a.set("start",c.start),a.set("end",c.end)),"add"!==r&&(n=s.get("orderId"),n="insert-before"===r?n:n+1),t._createTask(a,n)};this.options.editable&&(this.footerDropDown=new W(this.footer.children(e).eq(0),{messages:{actions:n},direction:"up",animation:{open:{effects:"slideIn:up"}},navigatable:t.options.navigatable}),this.headerDropDown=new W(this.toolbar.children(e).eq(0),{messages:{actions:n},navigatable:t.options.navigatable}),this.footerDropDown.bind("command",r),this.headerDropDown.bind("command",r))},_list:function(){var t=this,e=t.options.navigatable,n=u.styles,i=this.wrapper.find(L+n.list),o=i.find("> div"),a=this.wrapper.find(L+n.toolbar.actions+" > button"),s={columns:this.options.columns||[],dataSource:this.dataSource,selectable:this.options.selectable,editable:this.options.editable,listWidth:i.outerWidth()},l=function(){e&&(t._current(t._cachedCurrent),r(t.list.content.find("table"),!0)),delete t._cachedCurrent};this.list=new f.ui.GanttList(o,s),this.list.bind("render",function(){t._navigatable()},!0).bind("edit",function(e){t._cachedCurrent=e.cell,t.trigger("edit",{task:e.model,container:e.cell})&&e.preventDefault()}).bind("cancel",function(e){t.trigger("cancel",{task:e.model,container:e.cell})&&e.preventDefault(),l()}).bind("update",function(e){t._updateTask(e.task,e.updateInfo),l()}).bind("change",function(){t.trigger("change");var e=t.list.select();e.length?(a.removeAttr("data-action","add"),t.timeline.select("[data-uid='"+e.attr("data-uid")+"']")):(a.attr("data-action","add"),t.timeline.clearSelection())})},_timeline:function(){var t=this,e=u.styles,n=i(x(!0,{},this.options)),o=this.wrapper.find(L+e.timeline+" > div");this.timeline=new f.ui.GanttTimeline(o,n),this.timeline.bind("navigate",function(n){t.toolbar.find(L+e.toolbar.views+" > li").removeClass(e.selected).end().find(L+e.toolbar.viewButton+"-"+n.view.replace(/\./g,"\\.").toLowerCase()).addClass(e.selected),t.refresh()}).bind("moveStart",function(e){t.trigger("moveStart",{task:e.task})&&e.preventDefault()}).bind("move",function(e){var n=e.task,i=e.start,o=new Date(i.getTime()+n.duration());t.trigger("move",{task:n,start:i,end:o})&&e.preventDefault()}).bind("moveEnd",function(e){var n=e.task,i=e.start,o=new Date(i.getTime()+n.duration());t.trigger("moveEnd",{task:n,start:i,end:o})||t._updateTask(t.dataSource.getByUid(n.uid),{start:i,end:o})}).bind("resizeStart",function(e){t.trigger("resizeStart",{task:e.task})&&e.preventDefault()}).bind("resize",function(e){t.trigger("resize",{task:e.task,start:e.start,end:e.end})&&e.preventDefault()}).bind("resizeEnd",function(e){var n=e.task,i={};e.resizeStart?i.start=e.start:i.end=e.end,t.trigger("resizeEnd",{task:n,start:e.start,end:e.end})||t._updateTask(t.dataSource.getByUid(n.uid),i)}).bind("percentResizeEnd",function(e){t._updateTask(t.dataSource.getByUid(e.task.uid),{percentComplete:e.percentComplete})}).bind("dependencyDragEnd",function(e){var n=t.dependencies._createNewModel({type:e.type,predecessorId:e.predecessor.id,successorId:e.successor.id});t._createDependency(n)}).bind("select",function(e){t.select("[data-uid='"+e.uid+"']")}).bind("editTask",function(e){t.editTask(e.uid)}).bind("clear",function(){t.clearSelection()}).bind("removeTask",function(e){t.removeTask(t.dataSource.getByUid(e.uid))}).bind("removeDependency",function(e){t.removeDependency(t.dependencies.getByUid(e.uid))})},_dataSource:function(){var t=this.options,e=t.dataSource;e=w(e)?{data:e}:e,this.dataSource&&this._refreshHandler?this.dataSource.unbind("change",this._refreshHandler).unbind("progress",this._progressHandler).unbind("error",this._errorHandler):(this._refreshHandler=_(this.refresh,this),this._progressHandler=_(this._requestStart,this),this._errorHandler=_(this._error,this)),this.dataSource=f.data.GanttDataSource.create(e).bind("change",this._refreshHandler).bind("progress",this._progressHandler).bind("error",this._errorHandler)},_dependencies:function(){var t=this.options.dependencies||{},e=w(t)?{data:t}:t;this.dependencies&&this._dependencyRefreshHandler?this.dependencies.unbind("change",this._dependencyRefreshHandler).unbind("error",this._dependencyErrorHandler):(this._dependencyRefreshHandler=_(this.refreshDependencies,this),this._dependencyErrorHandler=_(this._error,this)),this.dependencies=f.data.GanttDependencyDataSource.create(e).bind("change",this._dependencyRefreshHandler).bind("error",this._dependencyErrorHandler)},_createEditor:function(){var t=this,n=this._editor=new h(this.wrapper,x({},this.options,{target:this,createButton:_(this._createButton,this)}));n.bind("cancel",function(n){var i=t.dataSource.getByUid(n.model.uid);return t.trigger("cancel",{container:n.container,task:i})?(n.preventDefault(),e):(t.cancelTask(),e)}).bind("edit",function(e){var n=t.dataSource.getByUid(e.model.uid);t.trigger("edit",{container:e.container,task:n})&&e.preventDefault()}).bind("save",function(e){var n=t.dataSource.getByUid(e.model.uid);t.saveTask(n,e.updateInfo)}).bind("remove",function(e){t.removeTask(e.model.uid)})},_createButton:function(t){var e=t.name||t.text,n={className:u.styles.popup.button+" k-gantt-"+(e||"").replace(/\s/g,""),text:e,attr:""};if(!(e||b(t)&&t.template))throw Error("Custom commands should have name specified");return b(t)&&(t.className&&(t.className+=" "+n.className),n=x(!0,n,t)),f.template(R)(n)},view:function(t){return this.timeline.view(t)},dataItem:function(t){var e,n;return t?(e=this.list,n=e.content.find(t),e._modelFromElement(n)):null},setDataSource:function(t){this.options.dataSource=t,this._dataSource(),this.list._setDataSource(this.dataSource),this.options.autoBind&&t.fetch()},setDependenciesDataSource:function(t){this.options.dependencies=t,this._dependencies(),this.options.autoBind&&t.fetch()},items:function(){return this.wrapper.children(".k-task")},cancelTask:function(){var t=this._editor,e=t.container;e&&t.close()},editTask:function(t){var e,n="string"==typeof t?this.dataSource.getByUid(t):t;n&&(e=this.dataSource._createNewModel(n.toJSON()),e.uid=n.uid,this.cancelTask(),this._editTask(e))},_editTask:function(t){this._editor.editTask(t)},saveTask:function(t,e){var n=this._editor,i=n.container,o=n.editable;i&&o&&o.end()&&this._updateTask(t,e)},_updateTask:function(t,e){this.trigger("save",{task:t,values:e})||(this._preventRefresh=!0,this.dataSource.update(t,e),this._syncDataSource())},removeTask:function(t){var e=this,n="string"==typeof t?this.dataSource.getByUid(t):t;n&&this._taskConfirm(function(t){t||e._removeTask(n)},n)},_createTask:function(t,n){if(!this.trigger("add",{task:t,dependency:null})){var i=this.dataSource;this._preventRefresh=!0,n===e?i.add(t):i.insert(n,t),this._scrollToUid=t.uid,this._syncDataSource()}},_createDependency:function(t){this.trigger("add",{task:null,dependency:t})||(this._preventDependencyRefresh=!0,this.dependencies.add(t),this._preventDependencyRefresh=!1,this.dependencies.sync())},removeDependency:function(t){var e=this,n="string"==typeof t?this.dependencies.getByUid(t):t;n&&this._dependencyConfirm(function(t){t||e._removeDependency(n)},n)},_removeTaskDependencies:function(t,e){this._preventDependencyRefresh=!0;for(var n=0,i=e.length;i>n;n++)this.dependencies.remove(e[n]);this._preventDependencyRefresh=!1,this.dependencies.sync()},_removeTask:function(t){var e=this.dependencies.dependencies(t.id);this.trigger("remove",{task:t,dependencies:e})||(this._removeTaskDependencies(t,e),this._preventRefresh=!0,this.dataSource.remove(t)&&this._syncDataSource(),this._preventRefresh=!1)},_removeDependency:function(t){this.trigger("remove",{task:null,dependencies:[t]})||this.dependencies.remove(t)&&this.dependencies.sync()},_taskConfirm:function(t,e){this._confirm(t,{model:e,text:z,title:this.options.messages.deleteTaskWindowTitle})},_dependencyConfirm:function(t,e){this._confirm(t,{model:e,text:F,title:this.options.messages.deleteDependencyWindowTitle})},_confirm:function(t,e){var n,i,o=this.options.editable;o===!0||o.confirmation!==!1?(n=this.options.messages,i=[{name:"delete",text:n.destroy,className:u.styles.primary,click:function(){t()}},{name:"cancel",text:n.cancel,click:function(){t(!0)}}],this.showDialog(x(!0,{},e,{buttons:i}))):t()},showDialog:function(t){this._editor.showDialog(t)},refresh:function(){var t,e,i,o,r,a;this._preventRefresh||this.list.editable||(this._progress(!1),t=this.dataSource,e=t.taskTree(),i=this._scrollToUid,a=-1,this.current&&(r=this.current.closest("tr").attr(f.attr("uid")),a=this.current.index()),this.trigger("dataBinding")||(this._editor&&this._editor.close(),this.clearSelection(),this.list._render(e),this.timeline._render(e),this.timeline._renderDependencies(this.dependencies.view()),i&&(this._scrollTo(i),this.select(n(i))),(i||r)&&a>=0&&(o=this.list.content.find("tr"+n(i||r)+" > td:eq("+a+")"),this._current(o)),this._scrollToUid=null,this.trigger("dataBound")))},refreshDependencies:function(){this._preventDependencyRefresh||this.trigger("dataBinding")||(this.timeline._renderDependencies(this.dependencies.view()),this.trigger("dataBound"))},_syncDataSource:function(){this._preventRefresh=!1,this._requestStart(),this.dataSource.sync()},_requestStart:function(){this._progress(!0)},_error:function(){this._progress(!1)},_progress:function(t){f.ui.progress(this.element,t)},_resizable:function(){var e,n,i,o=this.wrapper,r=u.styles,a=L+r.gridContent,s=o.find(L+r.list),l=o.find(L+r.timeline);this._resizeDraggable=o.find(L+r.splitBar).height(s.height()).hover(function(){t(this).addClass(r.splitBarHover)},function(){t(this).removeClass(r.splitBarHover)}).end().kendoResizable({orientation:"horizontal",handle:L+r.splitBar,start:function(){e=s.width(),n=l.width(),i=l.find(a).scrollLeft()},resize:function(t){var o=t.x.initialDelta;0>e+o||0>n-o||(s.width(e+o),l.width(n-o),l.find(a).scrollLeft(i+o))}}).data("kendoResizable")},_scrollable:function(){var e=u.styles,n=L+e.gridContent,i=L+e.gridHeaderWrap,o=this.timeline.element,r=this.list.element;o.find(n).on("scroll",function(){o.find(i).scrollLeft(this.scrollLeft),r.find(n).scrollTop(this.scrollTop)}),r.find(n).on("scroll",function(){r.find(i).scrollLeft(this.scrollLeft)}).on("DOMMouseScroll"+S+" mousewheel"+S,function(e){var i=o.find(n),r=i.scrollTop(),a=f.wheelDeltaY(e);a&&(e.preventDefault(),t(e.currentTarget).one("wheel"+S,!1),i.scrollTop(r+-a))})},_navigatable:function(){var i,o=this,a=this.options.navigatable,s=this.options.editable,l=this.list.header.find("table"),c=this.list.content.find("table"),d=u.styles,h=this.timeline.element.find(L+d.gridContent),p=l.add(c),g=n(),m={collapse:!1,expand:!0},v=function(t){var e=o.timeline.view()._timeSlots()[0].offsetWidth;h.scrollLeft(h.scrollLeft()+(t?-e:e))},y=function(t){var e=o.current.parent("tr"+n()),i=o.current.index(),a=e[t]();0!==o.select().length&&o.clearSelection(),0!==a.length?(o._current(a.children("td:eq("+i+")")),o._scrollTo(o.current)):o.current.is("td")&&"prev"==t?r(l):o.current.is("th")&&"next"==t&&r(c)},w=function(t){var e=o.current[t]();0!==e.length&&(o._current(e),i=o.current.index())},_=function(t){var e=o.dataItem(o.current);e.summary&&e.expanded!==t&&e.set("expanded",t)},x=function(){var t,e;o.options.editable&&!o.list.editable&&(t=o.select(),e=f.attr("uid"),t.length&&o.removeTask(t.attr(e)))};return t(this.wrapper).on("mousedown"+S,"tr"+g+", div"+g+":not("+L+d.line+")",function(e){var i,l=t(e.currentTarget),c=t(e.target).is(":button,a,:input,a>.k-icon,textarea,span.k-icon,span.k-link,.k-input,.k-multiselect-wrap");e.ctrlKey||(a&&(i=l.is("tr")?t(e.target).closest("td"):o.list.content.find("tr"+n(l.attr(f.attr("uid")))+" > td:first"),o._current(i)),!a&&!s||c||setTimeout(function(){r(o.list.content.find("table"),!0)},2))}),a!==!0?(c.on("keydown"+S,function(t){t.keyCode==C.DELETE&&x()
}),e):(p.on("focus"+S,function(){var e=this===c.get(0)?"td":"th",n=(t(this),o.select()),r=o.current||t(n.length?n:this).find(e+":eq("+(i||0)+")");o._current(r)}).on("blur"+S,function(){o._current(),this==l&&t(this).attr(T,-1)}).on("keydown"+S,function(t){var e,n=t.keyCode;if(o.current)switch(e=o.current.is("td"),n){case C.RIGHT:t.preventDefault(),t.altKey?v():t.ctrlKey?_(m.expand):w("next");break;case C.LEFT:t.preventDefault(),t.altKey?v(!0):t.ctrlKey?_(m.collapse):w("prev");break;case C.UP:t.preventDefault(),y("prev");break;case C.DOWN:t.preventDefault(),y("next");break;case C.SPACEBAR:t.preventDefault(),e&&o.select(o.current.closest("tr"));break;case C.ENTER:t.preventDefault(),e?o.options.editable&&(o._cachedCurrent=o.current,o.list._startEditHandler(o.current),t.stopPropagation()):o.current.children("a.k-link").click();break;case C.ESC:t.stopPropagation();break;case C.DELETE:e&&x();break;default:n>=49&&57>=n&&o.view(o.timeline._viewByIndex(n-49))}}),e)},_current:function(e){var n,i=u.styles;this.current&&this.current.length&&this.current.removeClass(i.focused).removeAttr("id"),e&&e.length?(this.current=e.addClass(i.focused).attr("id",I),n=t(f._activeElement()),n.is("table")&&this.wrapper.find(n).length>0&&n.removeAttr(M).attr(M,I)):this.current=null},_dataBind:function(){var e,n=this;n.options.autoBind&&(this._preventRefresh=!0,this._preventDependencyRefresh=!0,e=t.map([this.dataSource,this.dependencies],function(t){return t.fetch()}),t.when.apply(null,e).done(function(){n._preventRefresh=!1,n._preventDependencyRefresh=!1,n.refresh()}))},_resize:function(){this._adjustDimensions(),this.timeline.view()._adjustHeight(),this.list._adjustHeight()}}),f.ui.plugin(u),x(!0,u,{styles:U})}(window.kendo.jQuery),window.kendo},"function"==typeof define&&define.amd?define:function(t,e){e()});