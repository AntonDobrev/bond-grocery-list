/*
* Kendo UI Beta v2014.3.1029 (http://www.telerik.com/kendo-ui)
* Copyright 2014 Telerik AD. All rights reserved.
*
* Kendo UI Beta license terms available at
* http://www.telerik.com/purchase/license-agreement/kendo-ui-beta.aspx
*/

!function(e,define){define(["./kendo.dom.min","./kendo.data.min"],e)}(function(){return function(e,t){function n(e){var n="string"==typeof e?[{name:[e],expand:!1}]:e,i="[object Array]"===ft.call(n)?n:n!==t?[n]:[];return gt(i,function(e){return"string"==typeof e?{name:[e],expand:!1}:{name:"[object Array]"===ft.call(e.name)?e.name.slice():[e.name],expand:e.expand}})}function i(e,t,n,r){var o,a,s,l;if(n||(n=t),r||(r=0),l=n.members[r],l&&!l.measure){if(s=l.children,a=s.length,n===t?e[lt.stringify([l.name])]=!!a:a&&(e[lt.stringify(rt(n,r))]=!0),a)for(o=0;a>o;o++)i(e,t,s[o],r);i(e,t,n,r+1)}}function r(t){var n,r,o={};t.length&&i(o,t[0]),n=[];for(r in o)n.push({name:e.parseJSON(r),expand:o[r]});return n}function o(e,t){var n,i,r,o,a=t.tuples||[],s=a[0];if(s&&s.members.length>e.length)for(n=s.members,i=0;n.length>i;i++)if(!n[i].measure){for(r=!1,o=0;e.length>o;o++)if(0===B(e[o]).indexOf(n[i].hierarchy)){r=!0;break}r||e.push({name:[n[i].name],expand:!1})}}function a(e){var t,n=[],i=e.members;for(t=0;i.length>t;t++)i[t].measure||n.push({name:[i[t].name],expand:i[t].children.length>0});return n}function s(e,t,i){var r,s;return e=e||{},o(t,e),i.length>1&&t.push({name:"Measures",measure:!0,children:n(i)}),r={members:t},e.tuples&&(s=y(e.tuples,r),s.tuple&&(t=a(s.tuple))),t}function l(e,t,n,i,r,o){var a,s,l,c,d,u,h=0,f=t;for(s in n[i].aggregates)a=n[i].aggregates[s],c=r[s],e[f]={ordinal:f,value:a,fmtValue:c?lt.format(c,a):a},++h,f+=o;d=n[i].items;for(l in d){u=d[l].index*h,u=f+u*o;for(s in d[l].aggregates)a=d[l].aggregates[s],c=r[s],e[u]={ordinal:u,value:a,fmtValue:c?lt.format(c,a):a},u+=o}}function c(e,t,n,i,r){var o,a,s,l,c,d,u=0;for(a in n[i].aggregates)o=n[i].aggregates[a],l=r[a],e[e.length]={ordinal:t++,value:o,fmtValue:l?lt.format(l,o):o},++u;c=n[i].items;for(s in c){d=c[s].index*u;for(a in c[s].aggregates)o=c[s].aggregates[a],l=r[a],e[e.length]={ordinal:t+d++,value:o,fmtValue:l?lt.format(l,o):o}}}function d(e){var t=lt.getter(e.field,!0);return function(n,i){return e.aggregate(t(n),i)}}function u(e,n,i){return e.tuples.length<g(n.tuples,i)?n:t}function h(e,t,n,i,r){var o,a,s,l=e.length,c=g(t,i),d=i.length||1;for(a=0;n>a;a++)for(o=0;l>o;o++)s=p(e[o],t)*d,s+=o%d,r[a*l+o].ordinal=a*c+s}function f(e,t,n,i,r){var o,a,s,l=e.length,c=(g(t,i),i.length||1);for(a=0;l>a;a++)for(s=p(e[a],t),s*=c,s+=a%c,o=0;n>o;o++)r[a*n+o].ordinal=s*n+o}function p(e,t){return y(t,e).index}function g(e,t){var n,i,r;if(!e.length)return 0;for(n=e.slice(),i=n.shift(),r=1;i;)i.members?[].push.apply(n,i.members):i.children&&(i.measure||(r+=i.children.length),[].push.apply(n,i.children)),i=n.shift();return t.length&&(r*=t.length),r}function m(e){return e||(e={tuples:[]}),e.tuples||(e.tuples=[]),e}function v(e,t,n){var i,r,o;if(!e)return 0;for(i=Math.max(n.length,1),r=e.members.slice(0,t),o=r.shift();o;)o.children?[].push.apply(r,o.children):(i++,[].push.apply(r,o.members)),o=r.shift();return i}function _(e,t,n){var i,r,o,a,s,l;if(!t[0])return{parsedRoot:null,tuples:e,memberIndex:0,index:0};if(i=y(e,t[0]),!i.tuple)return{parsedRoot:null,tuples:t,memberIndex:0,index:0};if(r=i.tuple.members,o=t[0].members,a=-1,r.length!==o.length)return{parsedRoot:null,tuples:t,memberIndex:0,index:0};for(s=0,l=r.length;l>s;s++)!r[s].measure&&o[s].children[0]&&(-1==a&&o[s].children.length&&(a=s),r[s].children=o[s].children);return n=Math.max(n.length,1),{parsedRoot:i.tuple,index:i.index*n,memberIndex:a,tuples:e}}function w(e,t){var n,i,r=!0;for(e=e.members,t=t.members,n=0,i=e.length;i>n;n++)e[n].measure||t[n].measure||(r=r&&B(e[n])===B(t[n]));return r}function y(e,t){var n,i,r,o,a,s,l,c=0;for(n=0,i=e.length;i>n;n++){if(r=e[n],w(r,t))return{tuple:r,index:c};for(c++,a=0,s=r.members.length;s>a;a++)if(l=r.members[a],!l.measure&&(o=y(l.children,t),c+=o.index,o.tuple))return{tuple:o.tuple,index:c}}return{index:c}}function b(e,t){var n,i,r,o="";for(i=0,r=e.length;r>i;i++)n=e[i],o+=n.name,t[o]||(t[o]=n)}function x(e,t){var n,i,r,o,a=e.members,s="",l="";for(n=0,i=a.length;i>n;n++){if(r=a[n],o){if(t[s+r.name]){s+=r.name,o=t[s];continue}return t[s+r.parentName]?t[s+r.parentName]:(r.parentName&&(l+=r.parentName),t[l])}if(s+=r.name,o=t[r.parentName],!o&&(o=t[s],!o))return null;o&&(l+=o.name)}return o}function k(e,t){var n,i,r,o;if(0===t.length)return-1;for(n=t[0],i=e.members,r=0,o=i.length;o>r;r++)if(i[r].name==n)return r}function C(n,i){if(!(0>i)){var r={name:"Measures",measure:!0,children:[e.extend({members:[],dataIndex:n.dataIndex},n.members[i])]};n.members.splice(i,1,r),n.dataIndex=t}}function S(e,t){var n,i,r,o,a,s;if(1>e.length)return[];for(n=[],i={},r=k(e[0],t),o=0;e.length>o;o++)a=e[o],a.dataIndex=o,C(a,r),s=x(a,i),s?s.children.push(0>r||!s.measure?a:a.members[r].children[0]):n.push(a),b(a.members,i);return n}function T(e,t){var n,i,r,o,a,s,l,c;if(!e||!e.length)return t;for(n=[],i=A(e),r=i.length,o=Math.max(t.length/r,1),a=0;r>a;a++)for(l=o*a,c=o*i[a],s=0;o>s;s++)n[l+s]=t[c+s];return n}function D(e,t){var n,i,r,o,a,s,l;if(!e||!e.length)return t;for(n=[],i=A(e),r=i.length,o=Math.max(t.length/r,1),s=0;o>s;s++)for(l=r*s,a=0;r>a;a++)n[l+a]=t[i[a]+l];return n}function A(e){var n,i,r,o,a,s,l;for(e=e.slice(),n=[],i=e.shift();i;){for(i.dataIndex!==t&&n.push(i.dataIndex),a=0,r=0,o=i.members.length;o>r;r++)l=i.members[r],s=l.children,l.measure?[].splice.apply(e,[0,0].concat(s)):[].splice.apply(e,[a,0].concat(s)),a+=s.length;i=e.shift()}return n}function P(e){var t=e.split(".");return t.length>2?t[0]+"."+t[1]:e}function E(e,t){var n=e.length-1,i=e[n],r=M(t,i);return r&&r.dir?i="ORDER("+i+".Children,"+r.field+".CurrentMember.MEMBER_CAPTION,"+r.dir+")":i+=".Children",e[n]=i,e}function M(e,t){for(var n=0,i=e.length;i>n;n++)if(0===t.indexOf(e[n].field))return e[n];return null}function I(e){var t,n="CROSSJOIN({";return e.length>2?(t=e.pop(),n+=I(e)):(n+=e.shift(),t=e.pop()),n+="},{",n+=t,n+="})"}function L(e,t){var n=e.slice(0);return t.length>1&&n.push("{"+t.join(",")+"}"),I(n)}function B(e){return e=e.name||e,"[object Array]"===ft.call(e)&&(e=e[e.length-1]),e}function z(e){for(var t=e.length,n=[],i=0;t>i;i++)n.push(e[i].name[0]);return n}function F(e,t){var n,i,r,o=0,a=e.length,s=t.length;for(t=t.slice(0);a>o;o++)for(n=e[o],r=0;s>r;r++)if(i=P(t[r]),-1!==n.indexOf(i)){t[r]=n;break}return t}function R(e){for(var t,n,i,r,o,a,s=[],l=[],c=[],d=0,u=e.length;u>d;d++)if(t=e[d],r=t.name,a=!1,"[object Array]"!==ft.call(r)&&(t.name=r=[r]),r.length>1)l.push(t);else{for(o=P(r[0]),n=0,i=c.length;i>n;n++)if(0===c[n].name[0].indexOf(o)){a=!0;break}a||c.push(t),t.expand&&s.push(t)}return s=s.concat(l),{root:c,expanded:s}}function O(e,t,n){var i,r,o,a,s,l,c,d,u="";if(e=e||[],i=R(e),r=i.root,o=z(r),a=[],i=i.expanded,s=i.length,l=0,d=[],o.length>1||t.length>1){for(a.push(L(o,t));s>l;l++)c=E(i[l].name,n),d=F(c,o),a.push(L(d,t));u+=a.join(",")}else{for(;s>l;l++)c=E(i[l].name,n),d.push(c[0]);u+=o.concat(d).join(",")}return u}function N(e){var t="",n=e.value,i=e.field,r=e.operator;return"in"==r?(t+="{",t+=n,t+="}"):(t+="Filter(",t+=i+".Children",t+=lt.format(j[r],i,n),t+=")"),t}function H(e,t){var n,i,r="",o=e.filters,a=o.length;for(i=a-1;i>=0;i--)n="SELECT (",n+=N(o[i]),n+=") ON 0",i==a-1?(n+=" FROM ["+t+"]",r=n):r=n+" FROM ( "+r+" )";return r}function V(e,t,n){var i,r,o="";if(t){o+="<"+e+">";for(r in t)i=t[r],n&&(r=r.replace(/([A-Z]+(?=$|[A-Z][a-z])|[A-Z]?[a-z]+)/g,"$1_").toUpperCase().replace(/_$/,"")),o+="<"+r+">"+i+"</"+r+">";o+="</"+e+">"}else o+="<"+e+"/>";return o}function U(e){if(null==e)return[];var t=ft.call(e);return"[object Array]"!==t?[e]:e}function W(e){var t,n,i,r,o={tuples:[]},a=U(lt.getter("Tuples.Tuple",!0)(e)),s=lt.getter("Caption['#text']"),l=lt.getter("UName['#text']"),c=lt.getter("LName['#text']"),d=lt.getter("LNum['#text']"),u=lt.getter("CHILDREN_CARDINALITY['#text']",!0),h=lt.getter("['@Hierarchy']"),f=lt.getter("PARENT_UNIQUE_NAME['#text']",!0);for(t=0;a.length>t;t++){for(n=[],i=U(a[t].Member),r=0;i.length>r;r++)n.push({children:[],caption:s(i[r]),name:l(i[r]),levelName:c(i[r]),levelNum:d(i[r]),hasChildren:parseInt(u(i[r]),10)>0,parentName:f(i[r]),hierarchy:h(i[r])});o.tuples.push({members:n})}return o}var j,G,q,$,Y,Q,X,K,Z,J,et,tt,nt,it,rt,ot,at,st,lt=window.kendo,ct=lt.ui,dt=lt.Class,ut=ct.Widget,ht=lt.data.DataSource,ft={}.toString,pt=function(e){return e},gt=e.map,mt=e.extend,vt=lt.isFunction,_t="change",wt="error",yt="progress",bt="stateReset",xt="<div/>",kt=".kendoPivotGrid",Ct="__row_total__",St="dataBinding",Tt="dataBound",Dt="expandMember",At="collapseMember",Pt="k-i-arrow-s",Et="k-i-arrow-e",Mt="#: data.member.caption || data.member.name #",It='#: data.dataItem ? (data.dataItem.fmtValue || data.dataItem.value) : "" #',Lt='<table class="k-pivot-layout"><tr><td><div class="k-pivot-rowheaders"></div></td><td><div class="k-pivot-table k-state-default"></div></td></tr></table>',Bt=dt.extend({init:function(e){this.options=mt({},this.options,e),this.dimensions=this._normalizeDescriptors("field",this.options.dimensions),this.measures=this._normalizeDescriptors("name",this.options.measures)},_normalizeDescriptors:function(e,t){var n,i,r,o;if(t=t||{},n={},"[object Array]"===ft.call(t)){for(r=0,o=t.length;o>r;r++)i=t[r],"string"==typeof i?n[i]={}:i[e]&&(n[i[e]]=i);t=n}return t},_asTuples:function(e,n,i){var r,o,a,s,l,c,d,u,h,f;if(i=i||[],r=this.dimensions||[],o=[],h=i.length||1,n.length||i.length)for(c=0;h>c;c++){for(a={members:[]},s=0,l=n.length;l>s;s++)u=B(n[s].name),a.members[a.members.length]={children:[],caption:(r[u]||{}).caption||"All",name:u,levelName:u,levelNum:"0",hasChildren:!0,parentName:t,hierarchy:u};h>1&&(a.members[a.members.length]={children:[],caption:i[c].caption,name:i[c].name,levelName:"MEASURES",levelNum:"0",hasChildren:!1,parentName:t,hierarchy:"MEASURES"}),o[o.length]=a}for(f in e)for(c=0;h>c;c++){for(d={members:[]},s=0,l=n.length;l>s;s++)u=B(n[s].name),d.members[d.members.length]=0===e[f].parentName.indexOf(u)?{children:[],caption:e[f].value,name:e[f].name,levelName:e[f].name,levelNum:1,hasChildren:!1,parentName:u,hierarchy:u}:{children:[],caption:(r[u]||{}).caption||"All",name:u,levelName:u,levelNum:"0",hasChildren:!0,parentName:t,hierarchy:u};h>1&&(d.members[d.members.length]={children:[],caption:i[c].caption,name:i[c].name,levelName:"MEASURES",levelNum:"0",hasChildren:!0,parentName:t,hierarchy:"MEASURES"}),o[o.length]=d}return o},_toDataArray:function(e,t,n,i,r){var o,a,s,l,c,d,u={};if(n&&n.length)for(o=this.measures||{},a=0;n.length>a;a++)s=o[n[a]],s.format&&(u[n[a]]=s.format);l=[],c=0,r(l,c,e,Ct,u,t);for(d in e)d!==Ct&&(c+=i,r(l,c,e,d,u,t));return l},_matchDescriptors:function(e,t,n,i){for(var r,o,a,s,l;i>0;)if(r=t[--i],o=B(r).split("&"),o.length>1&&(a=o[0],s=o[1],l=n[a],l(e)!=s))return!1;return!0},_isExpanded:function(e){for(var t=0,n=e.length;n>t;t++)if(e[t].expand)return!0;return!1},_calculateAggregate:function(e,t,n){var i,r,o,a={};for(o=0;e.length>o;o++)r=e[o].name,i=n.aggregates[r]||0,a[r]=e[o].aggregator(t,i);return a},_processColumns:function(e,n,i,r,o,a,s,l){var c,d,u,h,f,p;for(p=0;n.length>p;p++)if(d=n[p],d.expand){if(!this._matchDescriptors(o,n,i,p))continue;u=B(d),c=i[u](o),c=c!==t?""+c:c,u=u+"&"+c,h=r[u]||{index:s.columnIndex,name:u,parentName:u,value:c},f=a.items[u]||{aggregates:{}},a.items[u]={index:h.index,aggregates:this._calculateAggregate(e,o,f)},l&&(r[u]||s.columnIndex++,r[u]=h)}},_measureAggregators:function(e){var t,n,i,r,o=e.measures||[],a=this.measures||{},s=[];if(o.length)for(i=0,r=o.length;r>i;i++)t=o[i],n=a[t],n&&s.push({name:t,caption:n.caption,aggregator:d(n)});else s.push({name:"default",caption:"default",aggregator:function(){return 1}});return s},_buildGetters:function(e){var t,n,i,r,o,a={};for(r=0,o=e.length;o>r;r++)t=e[r],i=B(t),n=i.split("&"),n.length>1?a[n[0]]=lt.getter(n[0],!0):a[i]=lt.getter(i,!0);return a},process:function(e,i){var r,o,a,s,d,u,h,f,p,g,m,v,_,w,y,b,x,k,C,S,T,D,A,P;if(e=e||[],i=i||{},r=i.measures||[],o="rows"===i.measuresAxis,a=(o?i.rows:i.columns)||[],s=(o?i.columns:i.rows)||[],!a.length&&s.length&&(!r.length||r.length&&o)&&(a=s,s=[],o=!1),a.length||s.length||(o=!1),!a.length&&r.length&&(a=n(i.measures)),d={},u={},h={},p={columnIndex:0},g=this._measureAggregators(i),m=this._buildGetters(a),v=this._buildGetters(s),_=!1,a.length||s.length)for(w=this._isExpanded(s),_=!0,y=0,b=e.length;b>y;y++)for(x=d[Ct]||{items:{},aggregates:{}},this._processColumns(g,a,m,u,e[y],x,p,!w),x.aggregates=this._calculateAggregate(g,e[y],x),d[Ct]=x,k=0,C=s.length;C>k;k++)if(S=s[k],S.expand){if(!this._matchDescriptors(e[y],s,v,k))continue;T=B(S),f=v[T](e[y]),f=f!==t?""+f:f,h[f]={name:T+"&"+f,parentName:T,value:f},D=d[f]||{items:{},aggregates:{}},this._processColumns(g,a,m,u,e[y],D,p,!0),D.aggregates=this._calculateAggregate(g,e[y],D),d[f]=D}return _&&e.length?(!(g.length>1)||i.columns&&i.columns.length||(a=[]),u=this._asTuples(u,a,g),h=this._asTuples(h,s,[]),A=u.length,o&&(A=1,P=u,u=h,h=P),d=this._toDataArray(d,u.length,i.measures,A,o?l:c)):d=u=h=[],{axes:{columns:{tuples:u},rows:{tuples:h}},data:d}}}),zt=dt.extend({init:function(e,t){this.transport=t,this.options=t.options||{},this.transport.discover||vt(e.discover)&&(this.discover=e.discover)},read:function(e){return this.transport.read(e)},update:function(e){return this.transport.update(e)},create:function(e){return this.transport.create(e)},destroy:function(e){return this.transport.destroy(e)},discover:function(e){return this.transport.discover?this.transport.discover(e):(e.success({}),t)},catalog:function(n){var i,r=this.options||{};return n===t?(r.connection||{}).catalog:(i=r.connection||{},i.catalog=n,this.options.connection=i,e.extend(this.transport.options,{connection:i}),t)},cube:function(e){var n,i=this.options||{};return e===t?(i.connection||{}).cube:(n=i.connection||{},n.cube=e,this.options.connection=n,mt(!0,this.transport.options,{connection:n}),t)}}),Ft=ht.extend({init:function(e){var t,i;ht.fn.init.call(this,mt(!0,{},{schema:{axes:pt,cubes:pt,catalogs:pt,measures:pt,dimensions:pt,hierarchies:pt,levels:pt,members:pt}},e)),this.options.schema&&this.options.schema.cube&&(this.cubeBuilder=new Bt(this.options.schema.cube)),this.transport=new zt(this.options.transport||{},this.transport),this._columns=n(this.options.columns),this._rows=n(this.options.rows),t=this.options.measures||[],i="columns",null!==this.options.measures&&"[object Object]"===ft.call(this.options.measures)&&(t=this.options.measures.values||[],i=this.options.measures.axis||"columns"),this._measures=t||[],this._measuresAxis=i,this._axes={}},options:{serverSorting:!0,serverPaging:!0,serverFiltering:!0,serverGrouping:!0,serverAggregates:!0},catalog:function(e){return e===t?this.transport.catalog():(this.transport.catalog(e),this._mergeState({}),this._axes={},this.data([]),t)},cube:function(e){return e===t?this.transport.cube():(this.transport.cube(e),this._axes={},this._mergeState({}),this.data([]),t)},axes:function(){return this._axes},columns:function(e){return e===t?this._columns:(this._clearAxesData=!0,this._columns=n(e),this.query({columns:e,rows:this.rowsAxisDescriptors(),measures:this.measures()}),t)},rows:function(e){return e===t?this._rows:(this._clearAxesData=!0,this._rows=n(e),this.query({columns:this.columnsAxisDescriptors(),rows:e,measures:this.measures()}),t)},measures:function(e){return e===t?this._measures:(this._clearAxesData=!0,this.query({columns:this.columnsAxisDescriptors(),rows:this.rowsAxisDescriptors(),measures:e}),t)},measuresAxis:function(){return this._measuresAxis||"columns"},_expandPath:function(e,t){var i,r,o,a="columns"===t?"columns":"rows",l="columns"===t?"rows":"columns",c=n(e),d=B(c[c.length-1]);for(this._lastExpanded=a,c=s(this.axes()[a],c,this.measures()),i=0;c.length>i;i++)if(r=B(c[i]),r===d){if(c[i].expand)return;c[i].expand=!0}else c[i].expand=!1;o={},o[a]=c,o[l]=this._descriptorsForAxis(l),this._query(o)},_descriptorsForAxis:function(e){var t=this.axes(),n=this[e]()||[];return t&&t[e]&&t[e].tuples&&t[e].tuples[0]&&(n=r(t[e].tuples||[])),n},columnsAxisDescriptors:function(){return this._descriptorsForAxis("columns")},rowsAxisDescriptors:function(){return this._descriptorsForAxis("rows")},_process:function(e,t){this._view=e,t=t||{},t.items=t.items||this._view,this.trigger(_t,t)},_query:function(e){var t=this;return e||(this._clearAxesData=!0),t.query(mt({},{page:t.page(),pageSize:t.pageSize(),sort:t.sort(),filter:t.filter(),group:t.group(),aggregate:t.aggregate(),columns:this.columnsAxisDescriptors(),rows:this.rowsAxisDescriptors(),measures:this.measures()},e))},query:function(t){var n=this._mergeState(t);return this._data.length&&this.cubeBuilder?(this._params(n),this._updateLocalData(this._pristineData),e.Deferred().resolve().promise()):this.read(n)},_mergeState:function(e){return e=ht.fn._mergeState.call(this,e),e!==t&&(this._measures=U(e.measures),e.columns?e.columns=n(e.columns):e.columns||(this._columns=[]),e.rows?e.rows=n(e.rows):e.rows||(this._rows=[])),e},filter:function(e){return e===t?this._filter:(this._clearAxesData=!0,this._query({filter:e,page:1}),t)},expandColumn:function(e){this._expandPath(e,"columns")},expandRow:function(e){this._expandPath(e,"rows")},success:function(e){var t;this.cubeBuilder&&(t=(this.reader.data(e)||[]).slice(0)),ht.fn.success.call(this,e),t&&(this._pristineData=t)},_processResult:function(e,t){var n,i,r,o,a,s,l,c,d;return this.cubeBuilder&&(n=this.cubeBuilder.process(e,this._requestData),e=n.data,t=n.axes),s=this.columns().length,l=this.rows().length,c=t.columns&&t.columns.tuples,s||!l||!c||!this._rowMeasures().length&&this.measures().length||(t={columns:{},rows:t.columns}),s||l||"rows"!==this.measuresAxis()||!c||(t={columns:{},rows:t.columns}),this._axes={columns:m(this._axes.columns),rows:m(this._axes.rows)},t={columns:m(t.columns),rows:m(t.rows)},e=this._normalizeData(e,t.columns.tuples.length,t.rows.tuples.length),"rows"==this._lastExpanded?(i=t.columns.tuples,o=this._columnMeasures(),r=u(t.columns,this._axes.columns,o),r&&(a="columns",t.columns=r,h(i,r.tuples,t.rows.tuples.length,o,e),e=this._normalizeData(e,g(t.columns.tuples,o),t.rows.tuples.length))):"columns"==this._lastExpanded&&(i=t.rows.tuples,o=this._rowMeasures(),r=u(t.rows,this._axes.rows,o),r&&(a="rows",t.rows=r,f(i,r.tuples,t.columns.tuples.length,o,e),e=this._normalizeData(e,g(t.rows.tuples,o),t.columns.tuples.length))),this._lastExpanded=null,d=this._mergeAxes(t,e,a),this._axes=d.axes,d.data},_readData:function(e){var t=this.reader.axes(e),n=this.reader.data(e);return this._processResult(n,t)},_mergeAxes:function(e,t,n){var i,r,o,a,s,l=this._columnMeasures(),c=this._rowMeasures(),d=this.axes(),u=e.rows.tuples.length,h=g(d.columns.tuples,l),f=e.columns.tuples.length;return"columns"==n?(f=h,r=e.columns.tuples):(r=S(e.columns.tuples,l),t=D(r,t)),o=_(d.columns.tuples,r,l),"rows"==n?(u=g(e.rows.tuples,c),r=e.rows.tuples):(r=S(e.rows.tuples,c),t=T(r,t)),a=_(d.rows.tuples,r,c),d.columns.tuples=o.tuples,d.rows.tuples=a.tuples,h!==g(d.columns.tuples,l)?(i=o.index+v(o.parsedRoot,o.memberIndex,l),s=h+f,t=this._mergeColumnData(t,i,u,f,s)):(i=a.index+v(a.parsedRoot,a.memberIndex,c),t=this._mergeRowData(t,i,u,f)),{axes:d,data:t}},_mergeColumnData:function(e,t,n,i,r){var o,a,s,l=this.data().toJSON(),c=0,d=Math.max(this._columnMeasures().length,1);for(n=Math.max(n,1),l.length>0&&(c=d,r-=d),o=0;n>o;o++)a=t+o*r,s=e.splice(0,i),s.splice(0,c),[].splice.apply(l,[a,0].concat(s));return l},_mergeRowData:function(e,t,n,i){var r,o,a,s=this.data().toJSON(),l=Math.max(this._rowMeasures().length,1);for(i=Math.max(i,1),s.length>0&&(n-=l,e.splice(0,i*l)),r=0;n>r;r++)a=e.splice(0,i),o=t*i+r*i,[].splice.apply(s,[o,0].concat(a));return s},_columnMeasures:function(){var e=this.measures(),t=[];return"columns"===this.measuresAxis()&&(0===this.columns().length?t=e:e.length>1&&(t=e)),t},_rowMeasures:function(){var e=this.measures(),t=[];return"rows"===this.measuresAxis()&&(0===this.rows().length?t=e:e.length>1&&(t=e)),t},_updateLocalData:function(e,t){this.cubeBuilder&&(t&&(this._requestData=t),e=this._processResult(e)),this._data=this._observe(e),this._ranges=[],this._addRange(this._data),this._total=this._data.length,this._pristineTotal=this._total,this._process(this._data)},data:function(e){var n=this;return e===t?n._data:(this._pristineData=e.slice(0),this._updateLocalData(e,{columns:this.columns(),rows:this.rows(),measures:this.measures()}),t)},_normalizeData:function(e,t,n){var i,r,o,a=(t||1)*(n||1),s=Array(a);if(e.length===a)return e;for(r=0,o=s.length;o>r;r++)s[r]={value:"",fmtValue:"",ordinal:r};for(r=0,o=e.length;o>r;r++)i=e[r],i&&(s[i.ordinal]=i);return s},discover:function(t,n){var i=this,r=i.transport;return e.Deferred(function(e){r.discover(mt({success:function(t){t=i.reader.parse(t),i._handleCustomErrors(t)||(n&&(t=n(t)),e.resolve(t))},error:function(t,n,r){e.reject(t),i.error(t,n,r)}},t))}).promise().done(function(){i.trigger("schemaChange")})},schemaMeasures:function(){var e=this;return e.discover({data:{command:"schemaMeasures",restrictions:{catalogName:e.transport.catalog(),cubeName:e.transport.cube()}}},function(t){return e.reader.measures(t)})},schemaDimensions:function(){var e=this;return e.discover({data:{command:"schemaDimensions",restrictions:{catalogName:e.transport.catalog(),cubeName:e.transport.cube()}}},function(t){return e.reader.dimensions(t)})},schemaHierarchies:function(e){var t=this;return t.discover({data:{command:"schemaHierarchies",restrictions:{catalogName:t.transport.catalog(),cubeName:t.transport.cube(),dimensionUniqueName:e}}},function(e){return t.reader.hierarchies(e)})},schemaLevels:function(e){var t=this;return t.discover({data:{command:"schemaLevels",restrictions:{catalogName:t.transport.catalog(),cubeName:t.transport.cube(),hierarchyUniqueName:e}}},function(e){return t.reader.levels(e)})},schemaCubes:function(){var e=this;return e.discover({data:{command:"schemaCubes",restrictions:{catalogName:e.transport.catalog()}}},function(t){return e.reader.cubes(t)})},schemaCatalogs:function(){var e=this;return e.discover({data:{command:"schemaCatalogs"}},function(t){return e.reader.catalogs(t)})},schemaMembers:function(e){var t=this;return t.discover({data:{command:"schemaMembers",restrictions:mt({catalogName:t.transport.catalog(),cubeName:t.transport.cube()},e)}},function(e){return t.reader.members(e)})},_params:function(e){this._clearAxesData&&(this._axes={},this._data=this._observe([]),this._clearAxesData=!1,this.trigger(bt));var t=ht.fn._params.call(this,e);return t=mt({measures:this.measures(),measuresAxis:this.measuresAxis(),columns:this.columns(),rows:this.rows()},t),this.cubeBuilder&&(this._requestData=t),t}});Ft.create=function(e){e=e&&e.push?{data:e}:e;var t=e||{},n=t.data;if(t.data=n,!(t instanceof Ft)&&t instanceof lt.data.DataSource)throw Error("Incorrect DataSource type. Only PivotDataSource instances are supported");return t instanceof Ft?t:new Ft(t)},j={contains:', InStr({0}.CurrentMember.MEMBER_CAPTION,"{1}") > 0',doesnotcontain:', InStr({0}.CurrentMember.MEMBER_CAPTION,"{1}") = 0',startswith:', Left({0}.CurrentMember.MEMBER_CAPTION,Len("{1}"))="{1}"',endswith:', Right({0}.CurrentMember.MEMBER_CAPTION,Len("{1}"))="{1}"',eq:', {0}.CurrentMember.MEMBER_CAPTION = "{1}"',neq:', NOT {0}.CurrentMember.MEMBER_CAPTION = "{1}"'},G={schemaCubes:"MDSCHEMA_CUBES",schemaCatalogs:"DBSCHEMA_CATALOGS",schemaMeasures:"MDSCHEMA_MEASURES",schemaDimensions:"MDSCHEMA_DIMENSIONS",schemaHierarchies:"MDSCHEMA_HIERARCHIES",schemaLevels:"MDSCHEMA_LEVELS",schemaMembers:"MDSCHEMA_MEMBERS"},q={read:function(e){var t,n,i,r,o,a='<Envelope xmlns="http://schemas.xmlsoap.org/soap/envelope/"><Header/><Body><Execute xmlns="urn:schemas-microsoft-com:xml-analysis"><Command><Statement>';return a+="SELECT NON EMPTY {",t=e.columns||[],n=e.rows||[],i=e.measures||[],r="rows"===e.measuresAxis,o=e.sort||[],!t.length&&n.length&&(!i.length||i.length&&r)&&(t=n,n=[],r=!1),t.length||n.length||(r=!1),t.length?a+=O(t,r?[]:i,o):i.length&&!r&&(a+=i.join(",")),a+="} DIMENSION PROPERTIES CHILDREN_CARDINALITY, PARENT_UNIQUE_NAME ON COLUMNS",(n.length||r&&i.length>1)&&(a+=", NON EMPTY {",a+=n.length?O(n,r?i:[],o):i.join(","),a+="} DIMENSION PROPERTIES CHILDREN_CARDINALITY, PARENT_UNIQUE_NAME ON ROWS"),e.filter?(a+=" FROM ",a+="(",a+=H(e.filter,e.connection.cube),a+=")"):a+=" FROM ["+e.connection.cube+"]",1==i.length&&t.length&&(a+=" WHERE ("+i.join(",")+")"),a+="</Statement></Command><Properties><PropertyList><Catalog>"+e.connection.catalog+"</Catalog><Format>Multidimensional</Format></PropertyList></Properties></Execute></Body></Envelope>",a.replace(/\&/g,"&amp;")},discover:function(t){t=t||{};var n='<Envelope xmlns="http://schemas.xmlsoap.org/soap/envelope/"><Header/><Body><Discover xmlns="urn:schemas-microsoft-com:xml-analysis">';return n+="<RequestType>"+(G[t.command]||t.command)+"</RequestType>",n+="<Restrictions>"+V("RestrictionList",t.restrictions,!0)+"</Restrictions>",t.connection&&t.connection.catalog&&(t.properties=e.extend({},{Catalog:t.connection.catalog},t.properties)),n+="<Properties>"+V("PropertyList",t.properties)+"</Properties>",n+="</Discover></Body></Envelope>"}},$=lt.data.RemoteTransport.extend({init:function(e){var t=e;e=this.options=mt(!0,{},this.options,e),lt.data.RemoteTransport.call(this,e),vt(t.discover)?this.discover=t.discover:"string"==typeof t.discover?this.options.discover={url:t.discover}:t.discover||(this.options.discover=this.options.read)},setup:function(t,n){return t.data=t.data||{},e.extend(!0,t.data,{connection:this.options.connection}),lt.data.RemoteTransport.fn.setup.call(this,t,n)},options:{read:{dataType:"text",contentType:"text/xml",type:"POST"},discover:{dataType:"text",contentType:"text/xml",type:"POST"},parameterMap:function(e,t){return q[t](e,t)}},discover:function(t){return e.ajax(this.setup(t,"discover"))}}),Y={cubes:{name:lt.getter("CUBE_NAME['#text']",!0),caption:lt.getter("CUBE_CAPTION['#text']",!0),description:lt.getter("DESCRIPTION['#text']",!0),type:lt.getter("CUBE_TYPE['#text']",!0)},catalogs:{name:lt.getter("CATALOG_NAME['#text']",!0),description:lt.getter("DESCRIPTION['#text']",!0)},measures:{name:lt.getter("MEASURE_NAME['#text']",!0),caption:lt.getter("MEASURE_CAPTION['#text']",!0),uniqueName:lt.getter("MEASURE_UNIQUE_NAME['#text']",!0),description:lt.getter("DESCRIPTION['#text']",!0),aggregator:lt.getter("MEASURE_AGGREGATOR['#text']",!0),groupName:lt.getter("MEASUREGROUP_NAME['#text']",!0),displayFolder:lt.getter("MEASURE_DISPLAY_FOLDER['#text']",!0),defaultFormat:lt.getter("DEFAULT_FORMAT_STRING['#text']",!0)},dimensions:{name:lt.getter("DIMENSION_NAME['#text']",!0),caption:lt.getter("DIMENSION_CAPTION['#text']",!0),description:lt.getter("DESCRIPTION['#text']",!0),uniqueName:lt.getter("DIMENSION_UNIQUE_NAME['#text']",!0),defaultHierarchy:lt.getter("DEFAULT_HIERARCHY['#text']",!0),type:lt.getter("DIMENSION_TYPE['#text']",!0)},hierarchies:{name:lt.getter("HIERARCHY_NAME['#text']",!0),caption:lt.getter("HIERARCHY_CAPTION['#text']",!0),description:lt.getter("DESCRIPTION['#text']",!0),uniqueName:lt.getter("HIERARCHY_UNIQUE_NAME['#text']",!0),dimensionUniqueName:lt.getter("DIMENSION_UNIQUE_NAME['#text']",!0),displayFolder:lt.getter("HIERARCHY_DISPLAY_FOLDER['#text']",!0),origin:lt.getter("HIERARCHY_ORIGIN['#text']",!0),defaultMember:lt.getter("DEFAULT_MEMBER['#text']",!0)},levels:{name:lt.getter("LEVEL_NAME['#text']",!0),caption:lt.getter("LEVEL_CAPTION['#text']",!0),description:lt.getter("DESCRIPTION['#text']",!0),uniqueName:lt.getter("LEVEL_UNIQUE_NAME['#text']",!0),dimensionUniqueName:lt.getter("DIMENSION_UNIQUE_NAME['#text']",!0),displayFolder:lt.getter("LEVEL_DISPLAY_FOLDER['#text']",!0),orderingProperty:lt.getter("LEVEL_ORDERING_PROPERTY['#text']",!0),origin:lt.getter("LEVEL_ORIGIN['#text']",!0),hierarchyUniqueName:lt.getter("HIERARCHY_UNIQUE_NAME['#text']",!0)},members:{name:lt.getter("MEMBER_NAME['#text']",!0),caption:lt.getter("MEMBER_CAPTION['#text']",!0),uniqueName:lt.getter("MEMBER_UNIQUE_NAME['#text']",!0),dimensionUniqueName:lt.getter("DIMENSION_UNIQUE_NAME['#text']",!0),hierarchyUniqueName:lt.getter("HIERARCHY_UNIQUE_NAME['#text']",!0),levelUniqueName:lt.getter("LEVEL_UNIQUE_NAME['#text']",!0),childrenCardinality:lt.getter("CHILDREN_CARDINALITY['#text']",!0)}},Q=["axes","catalogs","cubes","dimensions","hierarchies","levels","measures"],X=lt.data.XmlDataReader.extend({init:function(e){lt.data.XmlDataReader.call(this,e),this._extend(e)},_extend:function(e){for(var t,n,i=0,r=Q.length;r>i;i++)t=Q[i],n=e[t],n&&n!==pt&&(this[t]=n)},parse:function(e){var t=lt.data.XmlDataReader.fn.parse(e.replace(/<(\/?)(\w|-)+:/g,"<$1"));return lt.getter("['Envelope']['Body']",!0)(t)},errors:function(e){var t=lt.getter("['Fault']",!0)(e);return t?[{faultstring:lt.getter("faultstring['#text']",!0)(t),faultcode:lt.getter("faultcode['#text']",!0)(t)}]:null},axes:function(e){var t,n,i;return e=lt.getter("ExecuteResponse.return.root",!0)(e),t=U(lt.getter("Axes.Axis",!0)(e)),n=W(t[0]),i={},t.length>2&&(i=W(t[1])),{columns:n,rows:i}},data:function(e){var t,n,i,r,o,a;for(e=lt.getter("ExecuteResponse.return.root",!0)(e),t=U(lt.getter("CellData.Cell",!0)(e)),n=[],i=lt.getter("['@CellOrdinal']"),r=lt.getter("Value['#text']"),o=lt.getter("FmtValue['#text']"),a=0;t.length>a;a++)n.push({value:r(t[a]),fmtValue:o(t[a]),ordinal:parseInt(i(t[a]),10)});return n},_mapSchema:function(e,t){var n,i,r,o,a;for(e=lt.getter("DiscoverResponse.return.root",!0)(e),n=U(lt.getter("row",!0)(e)),i=[],r=0;n.length>r;r++){o={};for(a in t)o[a]=t[a](n[r]);i.push(o)}return i},measures:function(e){return this._mapSchema(e,Y.measures)},hierarchies:function(e){return this._mapSchema(e,Y.hierarchies)},levels:function(e){return this._mapSchema(e,Y.levels)},dimensions:function(e){return this._mapSchema(e,Y.dimensions)},cubes:function(e){return this._mapSchema(e,Y.cubes)},catalogs:function(e){return this._mapSchema(e,Y.catalogs)},members:function(e){return this._mapSchema(e,Y.members)}}),mt(!0,lt.data,{PivotDataSource:Ft,XmlaTransport:$,XmlaDataReader:X,PivotCubeBuilder:Bt,transports:{xmla:$},readers:{xmla:X}}),K=function(e,t){if(!e)return null;for(var n=0,i=e.length;i>n;n++)if(e[n].field===t)return e[n];return null},Z=function(e,t){var n,i,r=[];for(n=0,i=e.length;i>n;n++)e[n].field!==t&&r.push(e[n]);return r},lt.ui.PivotSettingTarget=ut.extend({init:function(t,n){var i=this;ut.fn.init.call(i,t,n),i.element.addClass("k-pivot-setting"),i.dataSource=lt.data.PivotDataSource.create(n.dataSource),i._refreshHandler=e.proxy(i.refresh,i),i.dataSource.first(_t,i._refreshHandler),n.template||(i.options.template="<div data-"+lt.ns+'name="${data.name || data}">${data.name || data}'+(i.options.enabled?'<a class="k-button k-button-icon k-button-bare"><span class="k-icon k-setting-delete"></span></a>':"")+"</div>"),i.template=lt.template(i.options.template),i.emptyTemplate=lt.template(i.options.emptyTemplate),i._sortable(),i.element.on("click"+kt,".k-button,.k-item",function(t){var n=e(t.target),r=n.closest("["+lt.attr("name")+"]").attr(lt.attr("name"));r&&(n.hasClass("k-setting-delete")?i.remove(r):i.options.sortable&&n[0]===t.currentTarget&&i.sort({field:r,dir:n.find(".k-i-sort-asc")[0]?"desc":"asc"}))}),(n.filterable||n.sortable)&&(i.fieldMenu=new ct.PivotFieldMenu(i.element,{messages:i.options.messages.fieldMenu,filter:".k-setting-fieldmenu",filterable:n.filterable,sortable:n.sortable,dataSource:i.dataSource})),i.refresh()},options:{name:"PivotSettingTarget",template:null,filterable:!1,sortable:!1,emptyTemplate:"<div class='k-empty'>${data}</div>",setting:"columns",enabled:!0,messages:{empty:"Drop Fields Here"}},setDataSource:function(e){this.dataSource.unbind(_t,this._refreshHandler),this.dataSource=this.options.dataSource=e,this.fieldMenu&&this.fieldMenu.setDataSource(e),e.first(_t,this._refreshHandler),this.refresh()},_sortable:function(){var e=this;e.options.enabled&&(this.sortable=this.element.kendoSortable({connectWith:this.options.connectWith,filter:">:not(.k-empty)",hint:e.options.hint,cursor:"move",start:function(e){e.item.focus().blur()},change:function(t){var n=t.item.attr(lt.attr("name"));"receive"==t.action?e.add(n):"remove"==t.action?e.remove(n):"sort"==t.action&&e.move(n,t.newIndex)
}}).data("kendoSortable"))},_indexOf:function(e,t){var n,i,r=-1;for(n=0,i=t.length;i>n;n++)if(B(t[n])===e){r=n;break}return r},validate:function(e){var t,n,i=2==e.type||"aggregator"in e;return i?"measures"===this.options.setting:"measures"===this.options.setting?i:(t=this.dataSource[this.options.setting](),n=e.defaultHierarchy||e.uniqueName,this._indexOf(n,t)>-1?!1:(t=this.dataSource["columns"===this.options.setting?"rows":"columns"](),this._indexOf(n,t)>-1?!1:!0))},add:function(e){var t=this.dataSource[this.options.setting](),n=this._indexOf(e,t);-1==n&&(t.push(e),this.dataSource[this.options.setting](t))},move:function(e,t){var n=this.dataSource[this.options.setting](),i=this._indexOf(e,n);i>-1&&(n.splice(i,1),n.splice(t,0,e),this.dataSource[this.options.setting](n))},remove:function(e){var t=this.dataSource[this.options.setting](),n=this._indexOf(e,t);n>-1&&(t.splice(n,1),this.dataSource[this.options.setting](t))},sort:function(e){var t=this.options.sortable,n=t===!0||t.allowUnsort,i=n&&"asc"===e.dir,r=this.dataSource.sort()||[],o=Z(r,e.field);i&&r.length!==o.length&&(e=null),e&&o.push(e),this.dataSource.sort(o)},refresh:function(){var e,n="",i=this.dataSource[this.options.setting](),r=i.length,o=0;if(r)for(;r>o;o++)e=i[o],e=e.name===t?{name:e}:e,n+=this.template(mt({sortIcon:this._sortIcon(e.name)},e));else n=this.emptyTemplate(this.options.messages.empty);this.element.html(n)},destroy:function(){ut.fn.destroy.call(this),this.dataSource.unbind(_t,this._refreshHandler),this.element.off(kt),this.sortable&&this.sortable.destroy(),this.fieldMenu&&this.fieldMenu.destroy(),this.element=null,this._refreshHandler=null},_sortIcon:function(e){var t=this.dataSource.sort(),n=K(t,B(e)),i="";return n&&(i="k-i-sort-"+n.dir),i}}),J=ut.extend({init:function(n,i){var r,o,a=this;ut.fn.init.call(a,n,i),a._dataSource(),a._bindConfigurator(),a._wrapper(),a._createLayout(),a._columnBuilder=r=new ot,a._rowBuilder=o=new at,a._contentBuilder=new st,a._templates(),a.columnsHeader.add(a.rowsHeader).on("click","span.k-icon",function(){var n,i,s,l,c=e(this),d=r,u="expandColumn",h=c.attr(lt.attr("path")),f={axis:"columns",path:e.parseJSON(h)};c.parent().is("td")&&(d=o,u="expandRow",f.axis="rows"),i=c.hasClass(Pt),s=d.metadata[h],l=s.expanded===t,n=i?At:Dt,a.trigger(n,f)||(d.metadata[h].expanded=!i,c.toggleClass(Pt,!i).toggleClass(Et,i),!i&&l?a.dataSource[u](f.path):a.refresh())}),a._scrollable(),a.options.autoBind&&a.dataSource.fetch(),lt.notify(a)},events:[St,Tt,Dt,At],options:{name:"PivotGrid",autoBind:!0,reorderable:!0,filterable:!1,sortable:!1,height:null,columnWidth:100,configurator:"",columnHeaderTemplate:null,rowHeaderTemplate:null,dataCellTemplate:null,messages:{measureFields:"Drop Data Fields Here",columnFields:"Drop Column Fields Here",rowFields:"Drop Rows Fields Here"}},_templates:function(){var e=this.options.dataCellTemplate,t=this.options.columnHeaderTemplate,n=this.options.rowHeaderTemplate;this._columnBuilder.template=lt.template(t||Mt,{useWithBlock:!!t}),this._contentBuilder.template=lt.template(e||It,{useWithBlock:!!e}),this._rowBuilder.template=lt.template(n||Mt,{useWithBlock:!!n})},_bindConfigurator:function(){var t=this.options.configurator;t&&e(t).kendoPivotConfigurator("setDataSource",this.dataSource)},cellInfoByElement:function(t){return t=e(t),this.cellInfo(t.index(),t.parent("tr").index())},cellInfo:function(e,t){var n,i=this._contentBuilder,r=i.columnIndexes[e||0],o=i.rowIndexes[t||0];return r&&o?(n=o.index*i.rowLength+r.index,{columnTuple:r.tuple,rowTuple:o.tuple,measure:r.measure||o.measure,dataItem:this.dataSource.view()[n]}):null},setDataSource:function(e){this.options.dataSource=e,this._dataSource(),this.measuresTarget&&this.measuresTarget.setDataSource(e),this.rowsTarget&&this.rowsTarget.setDataSource(e),this.columnsTarget&&this.columnsTarget.setDataSource(e),this._bindConfigurator(),this.options.autoBind&&e.fetch()},setOptions:function(e){ut.fn.setOptions.call(this,e),this._templates()},_dataSource:function(){var t=this,n=t.options.dataSource;n=e.isArray(n)?{data:n}:n,t.dataSource&&this._refreshHandler?t.dataSource.unbind(_t,t._refreshHandler).unbind(bt,t._stateResetHandler).unbind(yt,t._progressHandler).unbind(wt,t._errorHandler):(t._refreshHandler=e.proxy(t.refresh,t),t._progressHandler=e.proxy(t._requestStart,t),t._stateResetHandler=e.proxy(t._stateReset,t),t._errorHandler=e.proxy(t._error,t)),t.dataSource=lt.data.PivotDataSource.create(n).bind(_t,t._refreshHandler).bind(yt,t._progressHandler).bind(bt,t._stateResetHandler).bind(wt,t._errorHandler)},_error:function(){this._progress(!1)},_requestStart:function(){this._progress(!0)},_stateReset:function(){this._columnBuilder.reset(),this._rowBuilder.reset()},_wrapper:function(){this.wrapper=this.element.addClass("k-widget k-pivot")},_measureFields:function(){this.measureFields=e(xt).addClass("k-pivot-toolbar k-header k-settings-measures"),this.measuresTarget=this._createSettingTarget(this.measureFields,{setting:"measures",messages:{empty:this.options.messages.measureFields}})},_createSettingTarget:function(t,n){var i='<span tabindex="0" class="k-button" data-'+lt.ns+'name="${data.name}">${data.name}',r=n.sortable,o="";return r&&(o+="#if (data.sortIcon) {#",o+='<span class="k-icon ${data.sortIcon} k-setting-sort"></span>',o+="#}#"),(n.filterable||r)&&(o+='<span class="k-icon k-i-arrowhead-s k-setting-fieldmenu"></span>'),this.options.reorderable&&(o+='<span class="k-icon k-si-close k-setting-delete"></span>'),o&&(i+='<span class="k-field-actions">'+o+"</span>"),i+="</span>",new lt.ui.PivotSettingTarget(t,e.extend({template:i,emptyTemplate:'<span class="k-empty">${data}</span>',enabled:this.options.reorderable,dataSource:this.dataSource},n))},_initSettingTargets:function(){this.columnsTarget=this._createSettingTarget(this.columnFields,{connectWith:this.rowFields,setting:"columns",filterable:this.options.filterable,sortable:this.options.sortable,messages:{empty:this.options.messages.columnFields,fieldMenu:this.options.messages.fieldMenu}}),this.rowsTarget=this._createSettingTarget(this.rowFields,{connectWith:this.columnFields,setting:"rows",filterable:this.options.filterable,sortable:this.options.sortable,messages:{empty:this.options.messages.rowFields,fieldMenu:this.options.messages.fieldMenu}})},_createLayout:function(){var t=this,n=e(Lt),i=n.find(".k-pivot-rowheaders"),r=n.find(".k-pivot-table"),o=e(xt).addClass("k-grid k-widget");t._measureFields(),t.columnFields=e(xt).addClass("k-pivot-toolbar k-header k-settings-columns"),t.rowFields=e(xt).addClass("k-pivot-toolbar k-header k-settings-rows"),t.columnsHeader=e('<div class="k-grid-header-wrap" />').wrap('<div class="k-grid-header" />'),t.columnsHeader.parent().css("padding-right",lt.support.scrollbar()),t.rowsHeader=e('<div class="k-grid k-widget k-alt"/>'),t.content=e('<div class="k-grid-content" />'),i.append(t.measureFields),i.append(t.rowFields),i.append(t.rowsHeader),o.append(t.columnsHeader.parent()),o.append(t.content),r.append(t.columnFields),r.append(o),t.wrapper.append(n),t.columnsHeaderTree=new lt.dom.Tree(t.columnsHeader[0]),t.rowsHeaderTree=new lt.dom.Tree(t.rowsHeader[0]),t.contentTree=new lt.dom.Tree(t.content[0]),t._initSettingTargets()},_progress:function(e){lt.ui.progress(this.wrapper,e)},_resize:function(){this.content[0].firstChild&&(this._setSectionsWidth(),this._setSectionsHeight(),this._setContentWidth(),this._setContentHeight())},_setSectionsWidth:function(){var e=this.rowsHeader,t=e.parent(".k-pivot-rowheaders").width("auto"),n=Math.max(this.measureFields.outerWidth(),this.rowFields.outerWidth());n=Math.max(e.children("table").width(),n),t.width(n)},_setSectionsHeight:function(){var e=this.measureFields.height("auto").height(),t=this.columnFields.height("auto").height(),n=this.rowFields.height("auto").innerHeight(),i=this.columnsHeader.height("auto").innerHeight(),r=n-this.rowFields.height(),o=t>e?t:e,a=i>n?i:n;this.measureFields.height(o),this.columnFields.height(o),this.rowFields.height(a-r),this.columnsHeader.height(a)},_setContentWidth:function(){var e=this.content.find("table"),t=this.content.width(),n=e.children("colgroup").children().length,i=100,r=n*this.options.columnWidth;r>t&&(i=Math.ceil(r/t*100)),e.add(this.columnsHeader.children("table")).css("min-width",i+"%")},_setContentHeight:function(){var e=this,n=e.content,i=e.rowsHeader,r=e.options.height,o=lt.support.scrollbar(),a=n[0].offsetHeight===n[0].clientHeight;if(e.wrapper.is(":visible")){if(!r)return a&&(o=0),i.height(n.height()-o),t;r-=e.columnFields.outerHeight(),r-=e.columnsHeader.outerHeight(),2*o>=r&&(r=2*o+1),n.height(r),a&&(o=0),i.height(r-o)}},refresh:function(){var e,t=this,n=t.dataSource,i=n.axes(),r=(i.columns||{}).tuples||[],o=(i.rows||{}).tuples||[],a=t._columnBuilder,s=t._rowBuilder,l={},c={};t.trigger(St,{action:"rebind"})||(a.measures=n._columnMeasures(),t.columnsHeaderTree.render(a.build(r)),t.rowsHeaderTree.render(s.build(o)),l={indexes:a._indexes,measures:a.measures,metadata:a.metadata},c={indexes:s._indexes,measures:n._rowMeasures(),metadata:s.metadata},t.contentTree.render(t._contentBuilder.build(n.view(),l,c)),t._resize(),t.touchScroller?t.touchScroller.contentResized():(e=lt.touchScroller(t.content),e&&e.movable&&(t.touchScroller=e,e.movable.bind("change",function(e){t.columnsHeader.scrollLeft(-e.sender.x),t.rowsHeader.scrollTop(-e.sender.y)}))),t._progress(!1),t.trigger(Tt))},_scrollable:function(){var t=this,n=t.columnsHeader,i=t.rowsHeader;t.content.scroll(function(){n.scrollLeft(this.scrollLeft),i.scrollTop(this.scrollTop)}),i.bind("DOMMouseScroll"+kt+" mousewheel"+kt,e.proxy(t._wheelScroll,t))},_wheelScroll:function(t){var n,i;t.ctrlKey||(n=lt.wheelDeltaY(t),i=this.content.scrollTop(),n&&(t.preventDefault(),e(t.currentTarget).one("wheel"+kt,!1),this.rowsHeader.scrollTop(i+-n),this.content.scrollTop(i+-n)))}}),et=lt.dom.element,tt=lt.dom.html,nt=lt.dom.text,it=function(e,t){return{maxChildren:0,children:0,maxMembers:0,members:0,measures:1,levelNum:e,parentMember:0!==t}},rt=function(e,t){for(var n=[],i=0;t>=i;i++)n.push(e.members[i].name);return n},ot=dt.extend({init:function(){this.measures=1,this.metadata={}},build:function(e){var t=this._tbody(e),n=this._colGroup();return[et("table",null,[n,t])]},reset:function(){this.metadata={}},_colGroup:function(){for(var e=this._rowLength(),t=[],n=0;e>n;n++)t.push(et("col",null));return et("colgroup",null,t)},_tbody:function(e){var t=e[0];return this.map={},this.rows=[],this.rootTuple=t,this._indexes=[],t?(this._buildRows(t,0),this._normalize()):this.rows.push(et("tr",null,[et("th",null,[tt("&nbsp;")])])),et("tbody",null,this.rows)},_normalize:function(){for(var e,t,n,i,r,o=this.rows,a=o.length,s=0;a>s;s++)if(e=o[s],1!==e.rowSpan)for(i=e.children,n=0,t=i.length;t>n;n++)r=i[n],r.tupleAll&&(r.attr.rowSpan=e.rowSpan)},_rowIndex:function(e){for(var t=this.rows,n=t.length,i=0;n>i&&t[i]!==e;i++);return i},_rowLength:function(){var e=this.rows[0]?this.rows[0].children:[],t=e.length,n=0,i=0;if(t)for(;t>i;i++)n+=e[i].attr.colSpan||1;return n||(n=this.measures),n},_row:function(e,t,n){var i,r,o=this.rootTuple.members[t].name,a=e.members[t].levelNum,s=o+a,l=this.map,c=l[s];return c?(c.notFirst=!1,c.parentMember&&c.parentMember===n||(c.parentMember=n,c.colSpan=0)):(c=et("tr",null,[]),c.parentMember=n,c.colSpan=0,c.rowSpan=1,l[s]=c,i=l[o+(+a-1)],i&&(r=i.children,c.notFirst=r[1]&&-1===r[1].attr.className.indexOf("k-alt")?!0:i.notFirst),this.rows.splice(this._rowIndex(i)+1,0,c)),c},_measures:function(e,t,n){var i,r,o,a=this.map,s=a.measureRow;for(s||(s=et("tr",null,[]),a.measureRow=s,this.rows.push(s)),r=0,o=e.length;o>r;r++)i=e[r],s.children.push(et("th",{className:"k-header"+(n||"")},[this._content(i,t)]));return o},_content:function(e,t){return tt(this.template({member:e,tuple:t}))},_cell:function(e,t){return et("th",{className:"k-header"+e},t)},_buildRows:function(e,n,i){var r,o,a,s,l,c,d,u,h,f,p=e.members,g=p[n],m=p[n+1],v=[],_=0;if(g.measure)return this._measures(g.children,e),t;if(u=lt.stringify(rt(e,n)),r=this._row(e,n,i),a=g.children,s=a.length,f=this.metadata[u],f||(this.metadata[u]=f=it(+g.levelNum,n)),this._indexes.push({path:u,tuple:e}),g.hasChildren&&(f.expanded===!1&&(s=0,f.children=0),d={className:"k-icon "+(s?Pt:Et)},d[lt.attr("path")]=u,v.push(et("span",d))),v.push(this._content(g,e)),l=this._cell(r.notFirst?" k-first":"",v),r.children.push(l),r.colSpan+=1,s){for(c=this._cell(" k-alt",[this._content(g,e)]),r.children.push(c);s>_;_++)o=this._buildRows(a[_],n,g);h=o.colSpan,l.attr.colSpan=h,f.children=h,f.members=1,r.colSpan+=h,r.rowSpan=o.rowSpan+1,m&&(h=m.measure?this._measures(m.children,e," k-alt"):this._buildRows(e,n+1).colSpan,c.attr.colSpan=h,h-=1,f.members+=h,r.colSpan+=h)}else m&&(h=m.measure?this._measures(m.children,e):this._buildRows(e,n+1).colSpan,f.members=h,h>1&&(l.attr.colSpan=h,r.colSpan+=h-1));return f.children>f.maxChildren&&(f.maxChildren=f.children),f.members>f.maxMembers&&(f.maxMembers=f.members),(c||l).tupleAll=!0,r}}),at=dt.extend({init:function(){this.metadata={}},build:function(e){var t=this._tbody(e),n=this._colGroup();return[et("table",null,[n,t])]},reset:function(){this.metadata={}},_colGroup:function(){for(var e=this.rows[0].children.length,t=[],n=0;e>n;n++)t.push(et("col",null));return et("colgroup",null,t)},_tbody:function(e){var t=e[0];return this.rootTuple=t,this.rows=[],this.map={},this._indexes=[],t?(this._buildRows(t,0),this._normalize()):this.rows.push(et("tr",null,[et("td",null,[tt("&nbsp;")])])),et("tbody",null,this.rows)},_normalize:function(){for(var e,t,n,i,r=this.rows,o=r.length,a=0,s=this.rootTuple.members,l=s[0].name,c=s.length,d=0,u=this.map;o>a;a++)for(e=r[a],d=0;c>d;d++)n=this[s[d].name],t=e.colSpan["dim"+d],t&&n>t.levelNum&&(t.attr.colSpan=n-t.levelNum+1);e=u[l],i=u[l+"all"],e&&(e.children[0].attr.className="k-first"),i&&(i.children[0].attr.className+=" k-first")},_row:function(e){var t=et("tr",null,e);return t.rowSpan=1,t.colSpan={},this.rows.push(t),t},_content:function(e,t){return tt(this.template({member:e,tuple:t}))},_buildRows:function(e,t){var n,i,r,o,a,s,l,c,d,u=this.map,h=e.members,f=h[t],p=h[t+1],g=f.children,m=g.length,v=+f.levelNum+1,_=this.rootTuple.members[t].name,w=rt(e,t-1).join(""),y=w+(f.parentName||""),b=u[y+"all"]||u[y],x=[];if(!b||b.hasChild?b=this._row():b.hasChild=!0,f.measure){for(c={className:b.allCell?"k-grid-footer":""},b.children.push(et("td",c,[this._content(g[0],e)])),b.rowSpan=m,d=1;m>d;d++)this._row([et("td",c,[this._content(g[d],e)])]);return b}if(u[w+f.name]=b,n=lt.stringify(rt(e,t)),o=this.metadata[n],o||(this.metadata[n]=o=it(v-1,t)),this._indexes.push({path:n,tuple:e}),f.hasChildren&&(o.expanded===!1&&(m=0,o.children=0),a={className:"k-icon "+(m?Pt:Et)},a[lt.attr("path")]=n,x.push(et("span",a))),x.push(this._content(f,e)),l=et("td",{className:b.allCell&&!m?"k-grid-footer":""},x),l.levelNum=v,b.children.push(l),b.colSpan["dim"+t]=l,(!this[_]||v>this[_])&&(this[_]=v),m){for(b.allCell=!1,b.hasChild=!1,d=0;m>d;d++)i=this._buildRows(g[d],t),b!==i&&(b.rowSpan+=i.rowSpan);b.rowSpan>1&&(l.attr.rowSpan=b.rowSpan),o.children=b.rowSpan,s=et("td",{className:"k-grid-footer"},[this._content(f,e)]),s.levelNum=v,r=this._row([s]),r.colSpan["dim"+t]=s,r.allCell=!0,u[w+f.name+"all"]=r,p&&(i=this._buildRows(e,t+1),s.attr.rowSpan=i.rowSpan),b.rowSpan+=r.rowSpan,o.members=r.rowSpan}else p&&(b.hasChild=!1,this._buildRows(e,t+1),(s||l).attr.rowSpan=b.rowSpan,o.members=b.rowSpan);return o.children>o.maxChildren&&(o.maxChildren=o.children),o.members>o.maxMembers&&(o.maxMembers=o.members),b}}),st=dt.extend({init:function(){this.columnAxis={},this.rowAxis={}},build:function(e,n,i){var r,o,a=n.indexes[0],s=n.metadata[a?a.path:t];return this.columnAxis=n,this.rowAxis=i,this.data=e,this.rowLength=s?s.maxChildren+s.maxMembers:n.measures.length||1,this.rowLength||(this.rowLength=1),r=this._tbody(),o=this._colGroup(),[et("table",null,[o,r])]},_colGroup:function(){var e=this.columnAxis.measures.length||1,t=[],n=0;for(this.rows[0]&&(e=this.rows[0].children.length);e>n;n++)t.push(et("col",null));return et("colgroup",null,t)},_tbody:function(){return this.rows=[],this.data[0]?(this.columnIndexes=this._indexes(this.columnAxis),this.rowIndexes=this._indexes(this.rowAxis),this._buildRows()):this.rows.push(et("tr",null,[et("td",null,[tt("&nbsp;")])])),et("tbody",null,this.rows)},_indexes:function(e){var n,i,r,o,a,s=[],l=e.indexes,c=e.metadata,d=e.measures,u=d.length||1,h=0,f=0,p=0,g=l.length;if(!g){for(r=0;u>r;r++)s[r]={index:r,measure:d[r],tuple:null};return s}for(;g>p;p++){if(n=l[p],i=c[n.path],o=i.children+i.members,a=0,o&&(o-=u),i.expanded===!1&&i.children!==i.maxChildren&&(a=i.maxChildren),i.parentMember&&0===i.levelNum&&(o=-1),o>-1){for(r=0;u>r;r++)s[o+f+r]={children:o,index:h,measure:d[r],tuple:n.tuple},h+=1;for(;s[f]!==t;)f+=1}h+=a}return s},_buildRows:function(){for(var e=this.rowIndexes,t=e.length,n=0;t>n;n++)this.rows.push(this._buildRow(e[n]))},_buildRow:function(e){for(var t,n,i,r=e.index*this.rowLength,o=this.columnIndexes,a=o.length,s=[],l=0;a>l;l++)t=o[l],i={},t.children&&(i.className="k-alt"),n=this.template({columnTuple:t.tuple,rowTuple:e.tuple,measure:t.measure||e.measure,dataItem:this.data[r+t.index]}),s.push(et("td",i,[tt(n)]));return i={},e.children&&(i.className="k-grid-footer"),et("tr",i,s)}}),ct.plugin(J)}(window.kendo.jQuery),window.kendo},"function"==typeof define&&define.amd?define:function(e,t){t()});