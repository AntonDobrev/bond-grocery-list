/*
* Kendo UI Beta v2014.3.1029 (http://www.telerik.com/kendo-ui)
* Copyright 2014 Telerik AD. All rights reserved.
*
* Kendo UI Beta license terms available at
* http://www.telerik.com/purchase/license-agreement/kendo-ui-beta.aspx
*/

!function(t,define){define(["./kendo.core.min","./kendo.data.min"],t)}(function(){return function(t,e){e.ExcelExporter=e.Class.extend({init:function(n){this.columns=t.map(n.columns||[],this._prepareColumn),this.options=n;var i=n.dataSource;this.dataSource=i instanceof e.data.DataSource?new i.constructor(t.extend({},i.options,{page:n.allPages?0:i.page(),filter:i.filter(),pageSize:n.allPages?i.total():i.pageSize(),sort:i.sort(),group:i.group(),aggregate:i.aggregate()})):e.data.DataSource.create(i)},workbook:function(){var e=this.dataSource.fetch();return e.then(t.proxy(function(){return{sheets:[{columns:this._columns(),rows:this._rows(),freezePane:this._freezePane(),filter:this._filter()}]}},this))},_prepareColumn:function(n){return n.field&&!n.hidden?t.extend({},n,{groupHeaderTemplate:e.template(n.groupHeaderTemplate||"${title}: ${value}"),groupFooterTemplate:n.groupFooterTemplate?e.template(n.groupFooterTemplate):null,footerTemplate:n.footerTemplate?e.template(n.footerTemplate):null}):void 0},_filter:function(){if(!this.options.filterable)return null;var t=this._depth();return{from:t,to:t+this.columns.length-1}},_dataRows:function(e,n){var i=this._depth(),o=t.map(e,t.proxy(function(e){var o,r,a,s,l,c,d,h;return this._hierarchical()&&(n=this.dataSource.level(e)+1),o=t.map(Array(n),function(){return{background:"#dfdfdf",color:"#333"}}),i&&e.items?(r=t.grep(this.columns,function(t){return t.field==e.field})[0],a=r&&r.title?r.title:e.field,s=r?r.groupHeaderTemplate:null,l=a+": "+e.value,c=t.extend({title:a,field:e.field,value:e.value,aggregates:e.aggregates},e.aggregates[e.field]),s&&(l=s(c)),o.push({value:l,background:"#dfdfdf",color:"#333",colSpan:this.columns.length+i-n}),d=this._dataRows(e.items,n+1),d.unshift({type:"group-header",cells:o}),d.concat(this._footer(e,n+1))):(h=t.map(this.columns,t.proxy(this._cell,this,e)),this._hierarchical()&&(h[0].colSpan=i-n+1),{type:"data",cells:o.concat(h)})},this));return o},_footer:function(e,n){var i=[],o=!1,r=t.map(this.columns,function(t){return t.groupFooterTemplate?(o=!0,{background:"#dfdfdf",color:"#333",value:t.groupFooterTemplate(e.aggregates[t.field])}):{background:"#dfdfdf",color:"#333"}});return o&&i.push({type:"group-footer",cells:t.map(Array(n),function(){return{background:"#dfdfdf",color:"#333"}}).concat(r)}),i},_rows:function(){var e,n,i,o=this.dataSource.group(),r=this._dataRows(this.dataSource.view(),0);return this.columns.length&&(e=t.map(this.columns,function(t){return{background:"#7a7a7a",color:"#fff",value:t.title||t.field}}),e[0].colSpan=this._depth()+1,r.unshift({type:"header",cells:t.map(Array(o.length),function(){return{background:"#7a7a7a",color:"#fff"}}).concat(e)}),n=!1,i=t.map(this.columns,t.proxy(function(t){return t.footerTemplate?(n=!0,{background:"#dfdfdf",color:"#333",value:t.footerTemplate(this.dataSource.aggregates()[t.field])}):{background:"#dfdfdf",color:"#333"}},this)),n&&r.push({type:"footer",cells:t.map(Array(o.length),function(){return{background:"#dfdfdf",color:"#333"}}).concat(i)})),r},_freezePane:function(){var e=t.grep(this.columns,function(t){return t.locked}).length;return{rowSplit:1,colSplit:e?e+this.dataSource.group().length:0}},_cell:function(t,e){return e.field?{value:t.get(e.field)}:void 0},_hierarchical:function(){return this.options.hierarchy&&this.dataSource.level},_depth:function(){var t,e,n,i=this.dataSource,o=0;if(this._hierarchical()){for(t=i.view(),e=0;t.length>e;e++)n=i.level(t[e]),n>o&&(o=n);o++}else o=i.group().length;return o},_columns:function(){var e=this._depth(),n=t.map(Array(e),function(){return{width:20}});return n.concat(t.map(this.columns,function(t){return{width:parseInt(t.width,10),autoWidth:t.width?!1:!0}}))}}),e.ExcelMixin={extend:function(e){e.events.push("excelExport"),e.options.excel=t.extend(e.options.excel,this.options),e.saveAsExcel=this.saveAsExcel},options:{proxyURL:"",allPages:!1,filterable:!1,fileName:"Export.xlsx"},saveAsExcel:function(){var n=this.options.excel||{},i=new e.ExcelExporter({columns:this.columns,dataSource:this.dataSource,allPages:n.allPages,filterable:n.filterable,hierarchy:n.hierarchy});i.workbook().then(t.proxy(function(t){if(!this.trigger("excelExport",{workbook:t})){var i=new e.ooxml.Workbook(t);e.saveAs({dataURI:i.toDataURL(),fileName:t.fileName||n.fileName,proxyURL:n.proxyURL})}},this))}}}(kendo.jQuery,kendo),window.kendo},"function"==typeof define&&define.amd?define:function(t,e){e()});