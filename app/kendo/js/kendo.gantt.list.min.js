/*
* Kendo UI Beta v2014.3.1029 (http://www.telerik.com/kendo-ui)
* Copyright 2014 Telerik AD. All rights reserved.
*
* Kendo UI Beta license terms available at
* http://www.telerik.com/purchase/license-agreement/kendo-ui-beta.aspx
*/

!function(t,define){define(["./kendo.dom.min","./kendo.touch.min","./kendo.draganddrop.min","./kendo.columnsorter.min","./kendo.datetimepicker.min","./kendo.editable.min"],t)}(function(){return function(t){function e(t){var e,n,i=[],o=t.className;for(e=0,n=t.level;n>e;e++)i.push(r("span",{className:o}));return i}function n(){var e=i._activeElement();"body"!==e.nodeName.toLowerCase()&&t(e).blur()}var i=window.kendo,o=i.dom,r=o.element,a=o.text,s=i.support.mobileOS,l=i.ui,c=l.Widget,d=t.extend,h=t.map,u=t.isFunction,f=i.keys,p={title:"Title",start:"Start Time",end:"End Time",percentComplete:"% Done",parentId:"Predecessor ID",id:"ID",orderId:"Order ID"},g="string",m=".kendoGanttList",v="click",y=".",w={wrapper:"k-treelist k-grid k-widget",header:"k-header",alt:"k-alt",editCell:"k-edit-cell",group:"k-treelist-group",gridHeader:"k-grid-header",gridHeaderWrap:"k-grid-header-wrap",gridContent:"k-grid-content",gridContentWrap:"k-grid-content",selected:"k-state-selected",icon:"k-icon",iconCollapse:"k-i-collapse",iconExpand:"k-i-expand",iconHidden:"k-i-none",iconPlaceHolder:"k-icon k-i-none",input:"k-input",dropPositions:"k-insert-top k-insert-bottom k-add k-insert-middle",dropTop:"k-insert-top",dropBottom:"k-insert-bottom",dropAdd:"k-add",dropMiddle:"k-insert-middle",dropDenied:"k-denied",dragStatus:"k-drag-status",dragClue:"k-drag-clue",dragClueText:"k-clue-text"},_=l.GanttList=c.extend({init:function(t,e){c.fn.init.call(this,t,e),0===this.options.columns.length&&this.options.columns.push("title"),this.dataSource=this.options.dataSource,this._columns(),this._layout(),this._domTrees(),this._header(),this._sortable(),this._editable(),this._selectable(),this._draggable(),this._attachEvents(),this._adjustHeight()},_adjustHeight:function(){this.content.height(this.element.height()-this.header.parent().outerHeight())},destroy:function(){c.fn.destroy.call(this),this._reorderDraggable&&this._reorderDraggable.destroy(),this._tableDropArea&&this._tableDropArea.destroy(),this._contentDropArea&&this._contentDropArea.destroy(),this.touch&&this.touch.destroy(),this.content.off(m),this.header=null,this.content=null,this.levels=null,i.destroy(this.element)},options:{name:"GanttList",selectable:!0,editable:!0},_attachEvents:function(){var e=this,n=_.styles;e.content.on(v+m,"td > span."+n.icon+":not(."+n.iconHidden+")",function(n){var i=t(this),o=e._modelFromElement(i);o.set("expanded",!o.get("expanded")),n.stopPropagation()})},_domTrees:function(){this.headerTree=new o.Tree(this.header[0]),this.contentTree=new o.Tree(this.content[0])},_columns:function(){var t=this.options.columns,e=function(){this.field="",this.title="",this.editable=!1,this.sortable=!1};this.columns=h(t,function(t){return t="string"==typeof t?{field:t,title:p[t]}:t,d(new e,t)})},_layout:function(){var t=this.element,e=_.styles;t.addClass(e.wrapper).append("<div class='"+e.gridHeader+"'><div class='"+e.gridHeaderWrap+"'></div></div>").append("<div class='"+e.gridContentWrap+"'></div>"),this.header=t.find(y+e.gridHeaderWrap),this.content=t.find(y+e.gridContent)},_header:function(){var t=this.headerTree,e=r("colgroup",null,this._cols()),n=r("thead",{role:"rowgroup"},[r("tr",{role:"row"},this._ths())]),i=r("table",{style:{"min-width":this.options.listWidth+"px"},role:"grid"},[e,n]);t.render([i])},_render:function(t){var e,n,i;this.levels=[{field:null,value:0}],e=r("colgroup",null,this._cols()),n=r("tbody",{role:"rowgroup"},this._trs(t)),i=r("table",{style:{"min-width":this.options.listWidth+"px"},tabIndex:0,role:"treegrid"},[e,n]),this.contentTree.render([i]),this.trigger("render")},_ths:function(){var t,e,n,i,o=this.columns,s=[];for(n=0,i=o.length;i>n;n++)t=o[n],e={"data-field":t.field,"data-title":t.title,className:_.styles.header,role:"columnheader"},s.push(r("th",e,[a(t.title)]));return s},_cols:function(){var t,e,n,i,o,a=this.columns,s=[];for(i=0,o=a.length;o>i;i++)t=a[i],n=t.width,e=n&&0!==parseInt(n,10)?{style:{width:typeof n===g?n:n+"px"}}:null,s.push(r("col",e,[]));return s},_trs:function(t){var e,n,i,o,r,a=[],s=[],l=_.styles;for(o=0,r=t.length;r>o;o++)e=t[o],i=this._levels({idx:e.parentId,id:e.id,summary:e.summary}),n={"data-uid":e.uid,"data-level":i,role:"row"},e.summary&&(n["aria-expanded"]=e.expanded),o%2!==0&&s.push(l.alt),e.summary&&s.push(l.group),s.length&&(n.className=s.join(" ")),a.push(this._tds({task:e,attr:n,level:i})),s=[];return a},_tds:function(t){var e,n,i,o=[],a=this.columns;for(n=0,i=a.length;i>n;n++)e=a[n],o.push(this._td({task:t.task,column:e,level:t.level}));return r("tr",t.attr,o)},_td:function(t){var n=[],o=_.styles,s=t.task,l=t.column,c=s.get(l.field),d=l.format?i.format(l.format,c):c;return"title"===l.field&&(n=e({level:t.level,className:o.iconPlaceHolder}),n.push(r("span",{className:o.icon+" "+(s.summary?s.expanded?o.iconCollapse:o.iconExpand:o.iconHidden)}))),n.push(r("span",null,[a(d)])),r("td",{role:"gridcell"},n)},_levels:function(t){var e,n,i,o=this.levels,r=t.summary,a=t.idx,s=t.id;for(n=0,i=o.length;i>n;n++)if(e=o[n],e.field==a)return r&&o.push({field:s,value:e.value+1}),e.value},_sortable:function(){var t,e,n,o,r,a=this.columns,s=this.header.find("th");for(o=0,r=s.length;r>o;o++)t=a[o],t.sortable&&(n=s.eq(o),e=n.data("kendoColumnSorter"),e&&e.destroy(),n.attr("data-"+i.ns+"field",t.field).kendoColumnSorter({dataSource:this.dataSource}));s=null},_selectable:function(){var e=this,n=this.options.selectable;n&&this.content.on(v+m,"tr",function(n){var i=t(this);n.ctrlKey?e.clearSelection():e.select(i)})},select:function(t){var e=this.content.find(t),n=_.styles.selected;return e.length?(e.siblings(y+n).removeClass(n).attr("aria-selected",!1).end().addClass(n).attr("aria-selected",!0),void this.trigger("change")):this.content.find(y+n)},clearSelection:function(){var t=this.select();t.length&&(t.removeClass(_.styles.selected),this.trigger("change"))},_setDataSource:function(t){this.dataSource=t},_editable:function(){var e=this,i=_.styles,o="span."+i.icon+":not("+i.iconHidden+")",r=function(){e.editable&&e.editable.end()&&e._closeCell()},a=function(e){var o=t(e.currentTarget);o.hasClass(i.editCell)||n()};this.options.editable&&(this._startEditHandler=function(n){var i=n.currentTarget?t(n.currentTarget):n,o=e._columnFromElement(i);e.editable||o.editable&&e._editCell({cell:i,column:o})},e.content.on("focusin"+m,function(){clearTimeout(e.timer),e.timer=null}).on("focusout"+m,function(){e.timer=setTimeout(r,1)}).on("keydown"+m,function(t){var i,o,a=t.keyCode;switch(a){case f.ENTER:n(),r();break;case f.ESC:e.editable&&(i=e._editableContainer,o=e._modelFromElement(i),e.trigger("cancel",{model:o,cell:i})||e._closeCell(!0))}}),s?e.touch=e.content.kendoTouch({filter:"td",touchstart:function(t){a(t.touch)},doubletap:function(n){t(n.touch.initialTouch).is(o)||e._startEditHandler(n.touch)}}).data("kendoTouch"):e.content.on("mousedown"+m,"td",function(t){a(t)}).on("dblclick"+m,"td",function(n){t(n.target).is(o)||e._startEditHandler(n)}))},_editCell:function(e){var n,o=_.styles,r=e.cell,a=e.column,s=this._modelFromElement(r),l=this.dataSource._createNewModel(s.toJSON()),c=l.fields[a.field]||l[a.field],d=c.validation,h=i.attr("type"),f=i.attr("bind"),p={name:a.field,required:c.validation?c.validation.required===!0:!1};this._editableContent=r.children().detach(),this._editableContainer=r,r.data("modelCopy",l),"date"!==c.type&&"date"!==t.type(c)||!/H|m|s|F|g|u/.test(a.format)||("start"===a.field&&delete c.validation.dateCompare,p[f]="value:"+a.field,p[h]="date",n=function(e,n){t('<input type="text"/>').attr(p).appendTo(e).kendoDateTimePicker({format:n.format})}),this.editable=r.addClass(o.editCell).kendoEditable({fields:{field:a.field,format:a.format,editor:a.editor||n},model:l,clearContainer:!1}).data("kendoEditable"),d&&d.dateCompare&&u(d.dateCompare)&&d.message&&(t("<span "+i.attr("for")+'="'+a.field+'" class="k-invalid-msg"/>').hide().appendTo(r),r.find("[name="+a.field+"]").attr(i.attr("dateCompare-msg"),d.message)),this.trigger("edit",{model:s,cell:r})&&this._closeCell(!0)},_closeCell:function(t){var e=_.styles,n=this._editableContainer,i=this._modelFromElement(n),o=this._columnFromElement(n),r=o.field,a=n.data("modelCopy"),s={};s[r]=a.get(r),n.empty().removeData("modelCopy").removeClass(e.editCell).append(this._editableContent),this.editable.destroy(),this.editable=null,this._editableContainer=null,this._editableContent=null,t||("start"===r&&(s.end=new Date(s.start.getTime()+i.duration())),this.trigger("update",{task:i,updateInfo:s}))},_draggable:function(){var e,n=this,o=null,r=!0,a=_.styles,l="tr["+i.attr("level")+" = 0]:last",c={},h=function(){o=null,e=null,r=!0,c={}},u=function(t){for(var e=t;e;){if(o.get("id")===e.get("id")){r=!1;break}e=n.dataSource.taskParent(e)}},f=function(){var n=t(e).height(),o=i.getOffset(e).top;d(e,{beforeLimit:o+.25*n,afterLimit:o+.75*n})},p=function(t){var n,o=t.location,r=a.dropAdd,s="add",l=parseInt(e.attr(i.attr("level")),10);e.beforeLimit>=o?(n=e.prev(),r=a.dropTop,s="insert-before"):o>=e.afterLimit&&(n=e.next(),r=a.dropBottom,s="insert-after"),n&&parseInt(n.attr(i.attr("level")),10)===l&&(r=a.dropMiddle),c.className=r,c.command=s},g=function(){return n._reorderDraggable.hint.children(y+a.dragStatus).removeClass(a.dropPositions)};this.options.editable&&(this._reorderDraggable=this.content.kendoDraggable({distance:10,holdToDrag:s,group:"listGroup",filter:"tr[data-uid]",ignore:y+a.input,hint:function(e){return t('<div class="'+a.header+" "+a.dragClue+'"/>').css({width:300,paddingLeft:e.css("paddingLeft"),paddingRight:e.css("paddingRight"),lineHeight:e.height()+"px",paddingTop:e.css("paddingTop"),paddingBottom:e.css("paddingBottom")}).append('<span class="'+a.icon+" "+a.dragStatus+'" /><span class="'+a.dragClueText+'"/>')},cursorOffset:{top:-20,left:0},container:this.content,dragstart:function(t){n.editable&&t.preventDefault(),o=n._modelFromElement(t.currentTarget),this.hint.children(y+a.dragClueText).text(o.get("title"))},drag:function(t){r&&(p(t.y),g().addClass(c.className))},dragend:function(){h()},dragcancel:function(){h()}}).data("kendoDraggable"),this._tableDropArea=this.content.kendoDropTargetArea({distance:0,group:"listGroup",filter:"tr[data-uid]",dragenter:function(t){e=t.dropTarget,u(n._modelFromElement(e)),f(),g().toggleClass(a.dropDenied,!r)},dragleave:function(){r=!0,g()},drop:function(){var t=n._modelFromElement(e),i=t.orderId,a={parentId:t.parentId};if(r){switch(c.command){case"add":a.parentId=t.id;break;case"insert-before":a.orderId=t.parentId===o.parentId&&t.orderId>o.orderId?i-1:i;break;case"insert-after":a.orderId=t.parentId===o.parentId&&t.orderId>o.orderId?i:i+1}n.trigger("update",{task:o,updateInfo:a})}}}).data("kendoDropTargetArea"),this._contentDropArea=this.element.kendoDropTargetArea({distance:0,group:"listGroup",filter:y+a.gridContent,drop:function(){var t=n._modelFromElement(n.content.find(l)),e=t.orderId,i={parentId:null,orderId:null!==o.parentId?e+1:e};n.trigger("update",{task:o,updateInfo:i})}}).data("kendoDropTargetArea"))},_modelFromElement:function(t){var e=t.closest("tr"),n=this.dataSource.getByUid(e.attr(i.attr("uid")));return n},_columnFromElement:function(t){var e=t.closest("td"),n=e.parent(),i=n.children().index(e);return this.columns[i]}});d(!0,l.GanttList,{styles:w})}(window.kendo.jQuery),window.kendo},"function"==typeof define&&define.amd?define:function(t,e){e()});